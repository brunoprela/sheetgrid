import{m as c0,a as Ue,i as Ae,t as A0,b as Me,c as Pe,d as st,V as L0,e as Le,f as Pt,g as $0,u as V0,S as h0,o as de,h as U0,j as ke,k as s0,l as b0,n as W0,B as M0,s as He,W as J0,p as q0,q as H,r as jt,Y as je,v as nt,w as w0,x as Be,z as Fe,y as $e,A as Ve,G as Ge,F as Bt,M as Lt,C as ve,R as Ft,D as Ye,J as Ke,E as $t,H as ze,L as e0,I as Vt,K as Gt,N as Je,O as We,P as qe,Z as u0,Q as Xe,T as _e,U as Qe,_ as Ze,X as tx,$ as ex,a0 as I0,a1 as xx,a2 as ix,a3 as Yt,a4 as sx,a5 as rx,a6 as nx,a7 as be,a8 as ax,a9 as Kt,aa as ox,ab as cx,ac as hx,ad as ux,ae as lx,af as fx,ag as dx,ah as vx,ai as Q,aj as k,ak as X,al as x0,am as S0,an as _x,ao as W,ap as bx,aq as y0,ar as a0,as as G0,at as Y0,au as kt,av as mx,aw as px}from"./index-IvHHW0wi.js";function Ex(t){return c0(function(){return t})}function Ix(t,e){return Ue(function(x,s){return Ae(t(x,s)).pipe(A0(1),Ex(x))})}function zt(t,e){e===void 0&&(e=Pe);var x=Me(t,e);return Ix(function(){return x})}var i=$;(function(t,e){for(var x=$,s=t();;)try{var r=parseInt(x(514))/1+-parseInt(x(854))/2+-parseInt(x(1036))/3*(parseInt(x(947))/4)+parseInt(x(746))/5+-parseInt(x(506))/6+parseInt(x(1164))/7*(parseInt(x(1180))/8)+-parseInt(x(735))/9*(-parseInt(x(661))/10);if(r===e)break;s.push(s.shift())}catch{s.push(s.shift())}})(Q0,226680);var Sx=Object.defineProperty,gx=(t,e,x)=>e in t?Sx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:x}):t[e]=x,L=(t,e,x)=>gx(t,typeof e!=i(582)?e+"":e,x);const Cx=i(832),Tx="SNAPSHOT_URL_KEY",yx=2e3,Rx=i(1169),es=i(1218),Ox="HEARTBEAT_INTERVAL",wx=3e4,me="HEARTBEAT_TIMEOUT",pe=2e4,Nx=2e4,Dx=i(674),Ux=3,xs=i(1161),is=1e3,Ax=i(1154),Mx=i(649),ss=i(698),rs="/universer-api/uniscript";var Ee=(t=>(t[t[i(763)]=0]=i(763),t[t.OK=1]="OK",t[t[i(638)]=2]=i(638),t[t[i(500)]=3]=i(500),t[t[i(1181)]=4]=i(1181),t[t[i(688)]=5]=i(688),t[t[i(486)]=6]=i(486),t[t[i(1237)]=7]="INVALID_ARGUMENT",t[t[i(628)]=8]=i(628),t[t[i(1250)]=9]=i(1250),t[t[i(707)]=10]="LOGIN_FAILED",t[t[i(1033)]=11]=i(1033),t[t[i(761)]=12]=i(761),t[t[i(532)]=13]=i(532),t[t[i(971)]=14]=i(971),t[t[i(1048)]=5001]=i(1048),t[t[i(1200)]=6001]=i(1200),t[t[i(1120)]=6002]=i(1120),t[t[i(799)]=6003]=i(799),t[t[i(1084)]=7001]=i(1084),t[t.APPLY_NON_SEQUENTIAL_REVISION=7002]=i(853),t[t[i(939)]=7003]=i(939),t[t[i(588)]=7004]=i(588),t[t.APPLY_DUPLICATED=7005]=i(950),t[t[i(641)]=8001]="CONNECTOR_DATA_TOO_LARGE",t[t[i(636)]=9001]=i(636),t[t.LICENSE_MAX_MEMBERS_PER_UNIT_EXCEEDED=9002]="LICENSE_MAX_MEMBERS_PER_UNIT_EXCEEDED",t[t[i(1209)]=9003]=i(1209),t[t[i(1039)]=9004]=i(1039),t[t.LICENSE_DISTRO_REJECTED=9005]=i(881),t[t[i(1055)]=10001]=i(1055),t[t.YUUMI_URL_COL_OUT_OF_RANGE=10002]="YUUMI_URL_COL_OUT_OF_RANGE",t[t.YUUMI_RATE_OVER_LIMIT=10003]=i(840),t[t[i(789)]=10004]=i(789),t[t[i(1238)]=10010]="YUUMI_NO_CUBOID_FOR_QUESTION",t[t[i(1242)]=10011]="YUUMI_ASYNCIO_CANCELLED",t[t[i(701)]=10012]=i(701),t[t[i(1170)]=10013]="YUUMI_ALL_TABLES_IS_INVALID",t[t[i(766)]=10014]=i(766),t[t[i(1151)]=10015]=i(1151),t[t[i(1062)]=10016]=i(1062),t[t.PY_RUNTIME_SCRIPT_ERROR=11001]=i(843),t[t[i(909)]=12001]=i(909),t[t[i(551)]=12002]=i(551),t[t[i(996)]=12003]=i(996),t[t[i(657)]=12004]=i(657),t[t[i(1165)]=12005]=i(1165),t[t[i(1102)]=13001]=i(1102),t[t[i(882)]=13002]=i(882),t[t.EMAIL_HAS_BEEN_BOUND=13003]=i(737),t[t[i(1079)]=-1]="UNRECOGNIZED",t))(Ee||{}),r0=(t=>(t[t[i(1138)]=0]="UNIVER_UNKNOWN",t[t[i(652)]=1]="UNIVER_DOC",t[t[i(1171)]=2]=i(1171),t[t[i(572)]=3]="UNIVER_SLIDE",t[t[i(513)]=4]=i(513),t[t.UNRECOGNIZED=-1]=i(1079),t))(r0||{}),J=(t=>(t[t[i(569)]=0]=i(569),t[t[i(1021)]=1]=i(1021),t[t.JOIN=2]="JOIN",t[t[i(1163)]=3]="LEAVE",t[t[i(866)]=4]=i(866),t[t[i(1004)]=5]=i(1004),t[t.RECV=6]=i(951),t[t[i(1079)]=-1]="UNRECOGNIZED",t))(J||{}),C0=(t=>(t[t.UNKNOWN_CODE=0]=i(1037),t[t.OK=1]="OK",t[t[i(970)]=2]=i(970),t[t[i(519)]=1001]=i(519),t[t[i(1153)]=1002]=i(1153),t[t[i(565)]=1003]=i(565),t[t[i(1241)]=1004]=i(1241),t[t[i(1079)]=-1]=i(1079),t))(C0||{}),Ie=(t=>(t[t.Undefined=0]="Undefined",t[t[i(867)]=1]=i(867),t[t[i(637)]=2]=i(637),t[t[i(596)]=3]=i(596),t[t[i(1212)]=4]="UnitSnapshot",t[t[i(1057)]=5]="UserProfileImg",t[t[i(1079)]=-1]=i(1079),t))(Ie||{});const Px=i(680);function Lx(t){var e=i;return JSON[e(1220)](t).length}var l0=(t=>(t.OTHER_CLIENT_EDITING=i(566),t[i(500)]=i(500),t[i(1070)]=i(1070),t[i(911)]="CLOSE_ROOM",t[i(1044)]="JOIN_ROOM_FAILED",t[i(1097)]=i(1097),t[i(564)]="SOCKET_FAILED",t[i(1069)]="SUBMIT_CHANGESET_TIMEOUT",t))(l0||{});class g0{constructor(){var e=i;L(this,e(524),new h0),L(this,e(1160),this[e(524)][e(738)]())}[i(782)](e){var x=i;this[x(524)].next(e)}}class Se{constructor(){var e=i;L(this,e(1e3),new h0),L(this,e(597),this._commentUpdate$[e(738)]())}[i(781)](e){var x=i;this[x(1e3)][x(949)](e)}}var kx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},Jt=(t,e)=>(x,s)=>e(x,s,t);let B0=class extends L0{constructor(t,e){var x=i;super(),L(this,x(1194),new Map),L(this,"_roomCreated$",new h0),this[x(817)]=t,this[x(764)]=e,this[x(879)](W0(this[x(817)][x(803)](s0[x(1171)])[x(1140)](c0(s=>s[x(1135)]())),this[x(817)].getTypeOfUnitDisposed$(s0[x(652)]).pipe(c0(s=>s.getUnitId())),this[x(817)].getTypeOfUnitDisposed$(s0[x(572)])[x(1140)](c0(s=>s.getUnitId())))[x(982)](s=>this._removeRoom(s)))}[i(721)](t){var e=i;return this[e(1194)].has(t)?de(this[e(1194)][e(1071)](t)):this._roomCreated$[e(1140)](c0(x=>{var s=e;if(x===t)return this[s(1194)].get(x)}))}[i(1065)](t){var e=i;this[e(764)].setCurrentUser(t)}[i(651)](){var t=i;return this[t(764)][t(651)]()}updateMember(t,e){var x=i;let s=this[x(1194)][x(1071)](t);s||(s=new Hx,this[x(1194)][x(839)](t,s),this[x(682)].next(t)),s.updateMember(e)}[i(810)](t,e){var x=i;const s=this._roomMembers[x(1071)](t);s&&s[x(810)](e)}getRoom(t){var e=i;return this[e(1194)][e(1071)](t)}[i(1204)](t,e){var x=i;const s=this[x(1194)][x(1071)](t);if(s)return s[x(1204)](e)}[i(1245)](t){var e=i;const x=this[e(1194)][e(1071)](t);x&&(x[e(557)](),this[e(1194)][e(1127)](t))}[i(557)](){var t=i;this[t(1194)][t(962)](e=>e.dispose()),this[t(1194)][t(555)](),this._roomCreated$[t(1196)]()}};B0=kx([Jt(0,S0),Jt(1,k(_x))],B0);class Hx extends L0{constructor(){var e=i;super(...arguments),L(this,e(1007),new Map),L(this,"_members$",new M0(this._members)),L(this,e(863),this._members$[e(738)]())}[i(557)](){var e=i;this._members[e(555)]()}[i(941)](e){var x=i;this[x(1007)][x(839)](e[x(1105)],e),this[x(960)]()}[i(810)](e){var x=i;this[x(1007)].delete(e)}[i(1204)](e){var x=i;return this[x(1007)][x(1071)](e)}[i(653)](){var e=i;return Array.from(this[e(1007)][e(598)]())}_emitMembers(){var e=i;this[e(606)][e(949)](this[e(1007)])}}var jx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},N0=(t,e)=>(x,s)=>e(x,s,t),T0=(t=>(t[t.IDLE=0]=i(619),t[t[i(1137)]=1]=i(1137),t[t[i(1192)]=2]=i(1192),t[t[i(1018)]=3]=i(1018),t))(T0||{});const Wt={[C0.FAIL]:i(753),[C0.JOIN_ROOM_FULL]:i(1222),[C0[i(1153)]]:"session.room-not-exists",[C0[i(565)]]:i(625),[C0[i(1241)]]:i(1001)};let dt=class extends V0{constructor(t,e,x,s,r,n,a,o){var c=i;super(),L(this,c(984),new M0(0)),L(this,"sessionStatus$",this._sessionStatus$[c(738)]()),L(this,c(524),new h0),L(this,c(1160),this[c(524)][c(738)]()),L(this,c(830)),L(this,c(919)),L(this,c(622)),L(this,c(898),!1),L(this,c(720),null),this[c(906)]=t,this[c(1038)]=x,this[c(709)]=s,this[c(706)]=r,this[c(634)]=n,this[c(666)]=a,this._telemetryService=o,this._shouldReportTelemetry=!!this[c(723)],e.pipe(b0(this[c(885)])).subscribe(f=>{var _=c,l;typeof f>"u"||(this[_(830)]=f,f?(this._joinRoom(f),this[_(919)]=f[_(1215)][_(982)](h=>{var v=_;h[v(931)]===this._unitID&&this[v(1074)](h)})):(this[_(1243)](),this[_(984)][_(949)](2),(l=this[_(919)])==null||l[_(511)](),this._socketMessageSubscription=null))})}get[i(1176)](){var t=i;return this[t(984)][t(1058)]()}[i(975)](){var t=i,e,x;return(x=(e=this[t(830)])==null?void 0:e[t(1105)])!=null?x:null}[i(557)](){var t=i;super.dispose(),this[t(885)].next(),this.dispose$[t(1196)]()}close(){var t=i,e,x;this[t(1243)](),(e=this[t(830)])==null||e[t(851)]({cmd:J.LEAVE,data:{roomID:this._unitID}}),(x=this[t(830)])==null||x[t(993)](),this[t(524)][t(1196)](),this[t(984)][t(1196)](),this.dispose()}_onCombEvent(t){var e=i;t.cmd===J[e(1143)]?this[e(494)](t):t[e(1213)]===J[e(951)]&&this._onRecvEvent(t)}[i(976)](t){var e=i;this[e(984)][e(949)](1),t[e(851)]({cmd:J[e(1143)],routeKey:this[e(906)],routeType:"",data:{rooms:[{roomID:this[e(906)]}]}})}[i(494)](t){var e=i,x;if(t[e(860)]in Wt){this[e(666)][e(782)]({id:l0[e(1044)],data:Wt[t[e(860)]]}),this[e(984)][e(949)](2);return}this[e(984)][e(949)](3);const s=(x=t[e(1080)].roomInfos[this[e(906)]])==null?void 0:x[e(1125)];s&&s.forEach(r=>this._memberService[e(941)](this[e(906)],r))}[i(740)](t){var e=i;try{const x=t[e(1080)];switch(x.eventID){case H[e(884)]:this._onUserJoin(x),this[e(524)][e(949)](x);break;case H[e(539)]:this[e(900)](x),this[e(524)][e(949)](x);break;case H[e(893)]:case H[e(856)]:this[e(1133)](),this[e(1187)](),this._event$.next(x);break;case H.MSG_FOR_ERROR:this[e(1038)].error(e(1239)+JSON[e(1220)](x)),this[e(524)][e(949)](x);break;case H.COMMENT_UPDATE:this[e(634)][e(781)](x.data),this._event$.next(x);break;default:this[e(524)][e(949)](x)}}catch(x){this[e(1038)].error(x,t)}}[i(778)](t){var e=i;this[e(706)][e(941)](this._unitID,t[e(1080)])}[i(900)](t){var e=i;this[e(706)].removeMember(this[e(906)],t[e(1080)][e(1105)])}async[i(851)](t,e){var x=i;if(this[x(1176)]!==3||!this._socket)throw new Error(x(862));try{t[x(903)]===H[x(731)]&&(this[x(683)](),this._startTelemetryCollaborationNewChangeset(t)),this._socket.send({cmd:J[x(866)],routeKey:e,routeType:"",data:t})}catch(s){this[x(1038)][x(676)](s)}}[i(683)](){var t=i,e;this[t(622)]=setTimeout(()=>{var x=t;this[x(622)]=null,this[x(666)][x(782)]({id:l0[x(1069)]})},(e=this[t(709)][t(889)](me))!=null?e:pe)}[i(1187)](){var t=i;this._collaborationTimeoutTimer&&(clearTimeout(this[t(622)]),this._collaborationTimeoutTimer=null)}[i(807)](t){var e=i;if(!this._shouldReportTelemetry)return;const{data:x}=t,{unitID:s,changeset:r}=x,{mutations:n,type:a}=r;this._telemetryInfo={unitId:s,type:a,startTime:performance[e(529)](),stopTime:0,duration:0,size:Lx(n)}}_stopTelemetryCollaborationNewChangeset(){var t=i;if(this[t(898)]){if(!this[t(720)]){this._logService[t(676)](t(989),"telemetry info is not initialized");return}this[t(720)][t(998)]=performance[t(529)](),this[t(720)][t(724)]=this[t(720)][t(998)]-this._telemetryInfo[t(1026)],this[t(723)].capture(Px,this[t(720)]),this._telemetryInfo=null}}[i(1243)](){var t=i;this[t(720)]=null}};dt=jx([N0(2,Q),N0(3,x0),N0(4,k(B0)),N0(5,k(Se)),N0(6,k(g0)),N0(7,W(bx))],dt);const i0=st("collaboration-client.local-cache-service");function ns(t){var e=i;return e(988)+t}function $(t,e){var x=Q0();return $=function(s,r){s=s-486;var n=x[s];return n},$(t,e)}Object[i(838)];var Bx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},at=(t,e)=>(x,s)=>e(x,s,t);function Fx(t){var e=i;const{unitID:x,mutations:s}=t;return{unitId:x,subUnitId:s[0].params[e(1158)]}}let X0=class{constructor(t,e,x){var s=i;this._injector=t,this[s(718)]=e,this[s(812)]=x}[i(1217)](t){var e=i,x,s,r,n;const a=this[e(819)][e(1071)](Ye),{unitId:o,subUnitId:c}=Fx(t),f=a?.[e(1005)](o)[e(985)](),_=(s=(x=this[e(812)].getUnit(o))==null?void 0:x.getActiveSheet())==null?void 0:s[e(901)]();if(f[e(936)]===0||!o||!c)return;const l=[{id:$t.id,params:{unitId:o,subUnitId:_,selections:Ke[e(1224)](f)}}],h=this[e(718)].transformMutationsWithChangeset(t,l);if(!$0(h))throw h[e(676)];const v=(n=(r=h[e(852)][0])==null?void 0:r[e(695)])==null?void 0:n[e(1233)];if(Array[e(601)](v)&&v.length){if(v[e(936)]===l[0].params[e(1233)][e(936)]&&v[e(541)]((p,C)=>ze[e(1019)](p[e(607)],l[0][e(695)].selections[C][e(607)])))return;this[e(819)][e(1071)](e0)[e(533)]($t.id,{unitId:o,subUnitId:_,selections:v})}}};X0=Bx([at(0,k(X)),at(1,y0),at(2,S0)],X0);const rt=st(i(1230));var ge=(t=>(t[t[i(787)]=0]=i(787),t[t[i(878)]=1]=i(878),t))(ge||{});const t0=i(664),$x={},Vx=new Set([cx.id]);function qt(t,e,x,s,r){var n=i,a,o,c,f;const _=[];for(const v of t)if(Vx[n(1112)](v.id)){if(_.length>0)break;_[n(944)](v);break}else _.push(v);const l=(o=(a=r.getCurrentUser())==null?void 0:a[n(1052)])!=null?o:"unknown",h=(f=(c=r[n(651)]())==null?void 0:c[n(1105)])!=null?f:n(1141);return{changeset:{unitID:e,type:be(x[n(635)](e)),baseRev:s[n(585)](e),revision:0,userID:l,memberID:h,mutations:_},pendingMutations:t.slice(_[n(936)])}}function Gx(t,e,x,s,r){var n=i,a,o,c,f;const _=[t[n(567)]((v,p)=>{var C=n,D;const{id:P}=v,{id:T,type:A}=p,m=(D=v[C(695)])!=null?D:{actions:null},u=p[C(695)];if(P&&P!==T)throw new Error(C(786)+P+C(765)+T+".");return{...v,id:T,type:A,params:{unitId:u[C(1142)],textRanges:u[C(980)],actions:nx.compose(m[C(538)],u[C(538)])}}},{})],l=(o=(a=r[n(651)]())==null?void 0:a[n(1052)])!=null?o:n(1141),h=(f=(c=r[n(651)]())==null?void 0:c[n(1105)])!=null?f:n(1141);return{changeset:{unitID:e,type:be(x[n(635)](e)),baseRev:s[n(585)](e),revision:0,userID:l,memberID:h,mutations:_},pendingMutations:[]}}function Q0(){var t=["size","_schedule","ERROR_IMAGE","updateSnapshot","collaborators","_tryReconnect","MOBILE_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","offline","UNDEFINED","_userManagerService"," - ","YUUMI_PROMPT_MAX_TOKENS_EXCEEDED","saveChangeset","awaiting","socket close","_registerDependencies","_updateState","byteOffset","EvpKDF","find","_reverseMap","[DataLoaderService]","key","_onUserJoin","LIVESHARE_OPERATION","loadOfflineData","onCommentUpdate","emitEvent","_startCollaboration","_initDependencies","createDecryptor","Cannot assemble a changeset from multiple mutations of different types: ","NO_OTHER_CLIENTS_EDITING","_httpService","YUUMI_SUBSCRIPTION_NOT_FOUND","_onOffline","sigBytes","_createHmacHelper","lib","msCrypto","_redoStacks","interceptor","LIVESHARE_TERMINATE","[CollaborationEntity]","ENSURE_SNAPSHOT_EXECUTION","objects","COMPRESS_MUTATION_APPLY","loadUnitOfRevision","getTypeOfUnitDisposed$","fetchMiss","pad","refreshPermission","_startTelemetryCollaborationNewChangeset","initWorkbookPermissionChange","slice","removeMember","headers","_instanceService","Error on receiving event","_transformUndoredo","/resources","Unknown type. Will not load files from remote address.","_univerInstanceService","_replayCachedMutations","_injector","status$","buffer","string","sessionStatus$","originalMeta","[FetchingMissState]: invalid calling to `resend`.","toString","rev","fetchThroughInterceptors","baseRev","_socket","_initCloseConn","/universer-api/snapshot","_replaceFileID","ciphertext","_onMessage","sid","call","getOwnPropertyDescriptor","set","YUUMI_RATE_OVER_LIMIT","?size=","NoPadding","PY_RUNTIME_SCRIPT_ERROR","transformStack failed!","authzUrl","fetching missing changesets from "," in _schedule.","_onConnectionFailed","HmacMD5","_updateLocalCache","send","m2Prime","APPLY_NON_SEQUENTIAL_REVISION","531220LtGJLg","NEW_CHANGESETS","CHANGESET_SHOULD_RETRY","objectID","_nRounds","_process","code","entries","[CollaborationSession]: should not send message when the session is offline!","members$","getResourcesRequest","_transformStack","INGEST","HttpImport","collaboratorID",`
After: `,"_getLoginPath","onTransformRemoteChangesetByStateCache","AES","appendMutation","isPermissionRej","registerHTTPInterceptor","debug","transformMutationsWithChangeset","OTHER_CLIENTS_EDITING","disposeWithMe","[SyncedState]: invalid calling to `resend`.","LICENSE_DISTRO_REJECTED","MOBILE_HAS_BEEN_BOUND","ivSize","USERS_ENTER","dispose$","Base","_singleActiveUnitService","_acknowledgedAwaitingChangeset","getConfig","_sender","_status$","_onLocalMutation","CHANGESET_ACK","getTypeOfUnitAdded$","[PendingState]: received acknowledgement.","_entityInit$","connection error","_shouldReportTelemetry","_resendTimeout","_onUserLeave","getSheetId","findIndex","eventID","_transformRemoteChangesetByIMECache","getSheetBlock","_unitID","_substituteRedoStack","_submitChangeset","INVITE_CODE_HAS_BEEN_UES",'[CollaborationEntity]: initial state has been created before. You should not call "init" twice.',"CLOSE_ROOM","[CollaborationSessionService]","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=","csShouldRetryEvent","_createHandler","fromCharCode","status","parse","_socketMessageSubscription","readyForCollab","UPDATE_CURSOR","Utf8","[FetchMissState]","permissionRejEvent","_changesetReqId","getUnitOnRev","SYNCED","UPDATE_PERMISSION_OBJ","/fetchmissing?from=","liveShareOperation","routeKey","indexOf","fetching the latest document from the server.","_entities","toggleOnline","length","_updateStatus","revision","APPLY_REVISION_CONFILICT","close$","updateMember","addImageSourceCache","_getSignURL","push","src","url","164VPGoHF","CipherParams","next","APPLY_DUPLICATED","RECV","_toggleOnline","_xformMode","_createInitialState","/-/object/list","onRemoteRetry","padding","init","[CollaborationSocketService]: failed to create socket!","_emitMembers","hasher","forEach","/universer-api/stream/file/upload","compute","LIVESHARE_NEW_HOST","onMissedChangesetFetched","UNISCRIPT_RUN","format","saveSheetBlock","FAIL","EMAIL_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","/object/","UUID","editingUnit","getMemberID","_joinRoom","_collaborationSessionService","updateCollaborator","leaveEvent","textRanges","onLocalMutation","subscribe","_oKey","_sessionStatus$","getCurrentSelections","change$","getCollabEntity","unit-cache-","[CollaborationSession]","function","_toggleOffline","saveSnapshot","close","_clearLocalCache","_tryEnsureSocket","INVITE_CODE_REQUIRED","onSendChangeset","stopTime","_timeoutTimer","_commentUpdate$","session.room-cnt-exceeds","max","catch","HEARTBEAT","getWorkbookSelections","closeSession","_members","loadSheet","[PendingState]: unhandled univer type: ","/unit/","byteLength","_resendTimer","_clearRedo","setConfig","_clearTimeoutTimer","charCodeAt","reqId","ONLINE","equals","/universer-api/authz","HELLO","_snapshotService","onRemoteAck","SUCCUSS","_localCacheService","startTime","put","WordArray","reverse","awaitingChangeset","AWAITING_WITH_PENDING","_socketService","MOBILE_VERIFY_CODE_MISMATCH","requestParams","ERROR_IMAGE_TYPE","16473PyWTJr","UNKNOWN_CODE","_logService","LICENSE_EXPORT_SIZE_EXCEEDED","_getUndoStack","_listenToNetworkCondition","_getAPIPrefix","_type","JOIN_ROOM_FAILED","roles","POST","_sheetTransformSelectionsService","CHANGESET_REVISION_CONFILICT",`
Current: `,"SHOULD_CLOSE_CONN","enableAuthServer","userID","localCacheService","getUnitStatus$","YUUMI_UNABLE_LOAD_URL","pending","UserProfileImg","getValue","PERSON","iterations","_syncEditingCollabCursor","YUUMI_CONNECTOR_URL_NOT_FOUND","_imageSourceCache","getFocusedUnit","setCurrentUser"," to ","post","_resendWithTimeout","SUBMIT_CHANGESET_TIMEOUT","CONFLICT","get","execute","keySize","_onCombEvent","_iKey","_getDownloadEndpointURL","getCollabEntity$","onMissingChangesets","UNRECOGNIZED","data","onSyncEditingCollabCursor","Decryptor","_key","APPLY_REJECT","sheets","[SyncedState]: received acknowledgement.","onTransformIME","_transitionLocked","submit changeset error!","exports","/block/","_lockTransition","_clearUndo","title","startsWith","onTransformRemoteChangesetByIMECache","SOCKET_FAILED_RETRY","onRemoteChangeset","ceil","_transformSelections","_getSendChangesetTimeout","WECHAT_HAS_BEEN_BOUND","toggleOffline","words","memberID","updatePermissionPoint","getInterceptPoints","_scheduleCompleteTimestamp","localeService","_queuedRemoteChangesets","_onConnectionOpen","has","enableSingleActiveInstanceLock","unitID","getTime","_state$","reconnect","_decreaseWaiting","BufferedBlockAlgorithm","SNAPSHOT_HAS_BEEN_REMOVED","default","_transformIMECache","open$","deleteCollaborator","members","Cipher","delete","crypto","_doCryptBlock","_config","_doCreateSocket","_invKeySchedule","_stopTelemetryCollaborationNewChangeset","[CollaborationSocketService]: failed to get web socket factory!","getUnitId","awaiting_with_pending","JOINING","UNIVER_UNKNOWN","concat","pipe","unknown","unitId","JOIN","_getCtorByUniverType","c1Prime","OpenSSL","collabSubmitChangesetUrl","_executeRemoteChangeset","_undoRedoService","FETCH_MISS","YUUMI_AI_RUN_FAILED","x-univer-host","JOIN_ROOM_NOT_EXISTS","/universer-api/comb","shouldCloseConn","_initUnitPermissionChange","_hasher","subUnitId","onCommandExecuted","event$","LOCAL_CACHE_INTERVAL","repeat","LEAVE","9884utHMqp","INVITE_CODE_ALREADY_BOUND","_revisionService","entityInit$","[CollaborationUndoRedoService]","ws://127.0.0.1:8000/universer-api/comb/connect","YUUMI_ALL_TABLES_IS_INVALID","UNIVER_SHEET","listCollaborators","Hasher","createInstance","joinEvent","sessionStatus","PENDING","pauseCollaboration","COMMENT_UPDATE","336WhJmME","NOT_FOUND","method","editing status changed to","_waitForHeartbeatResponse","_clearHeartbeatTimer","_retryConnectingTimer","_clearCollaborationTimeoutTimer","_clearRetryConnectingTimer","createCollaborator","location","prototype","OFFLINE","_initRequestHeader","_roomMembers","FETCH_MISSING","complete","action","_cipher","BlockCipher","SNAPSHOT_INVALID_SNAPSHOT","_onConflict","list","_sendHeartbeatTimer","getMember","_handler","processBlock","kdf","setShowComponents","LICENSE_IMPORT_SIZE_EXCEEDED","/allowed","create","UnitSnapshot","cmd","encrypt","message$","finalize","transformSelections","/universer-api/user/session-ticket","_nDataBytes","stringify","[PendingState]: received rejection.","session.room-full",'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.',"deepClone","not_collab","Latin1","online$","onTransformState","_append","univer-pro.collaboration-client.single-active-unit-service","batchAllowed","NOT_COLLAB","selections","encode","_getCurrentRevision","_mode","INVALID_ARGUMENT","YUUMI_NO_CUBOID_FOR_QUESTION","save fail reason is ","Base64","GLOBAL_ROOMS_CNT_EXCEEDS","YUUMI_ASYNCIO_CANCELLED","_throwTelemetryCollaborationNewChangeset","onRemoteRej","_removeRoom","_awaitingChangeset","_checkMissing","image/jpeg","cfg","COMPLETION_FINISHED","uniscriptRunEvent","onTransformRemoteChangesetByIMECache callback is not added yet.","ALREADY_EXISTS","[CollaborationEntity]: cannot apply missing results on other states!","_ENC_XFORM_MODE","This method should not be called on the client side!","[AuthServerService]: you should provide authentication info on Node.js.","encryptBlock","onStateChange","[SyncedState]: received rejection.","_onJoinRoomEvent","_socketReady","Univer","_rescheduleHeartbeat","saveImage","blockSize","PERMISSION_DENIED","mutations","_change$","replace","confirm","apply","1626834xmnbbT","floor","random","error$","sendChangesetTimeout","unsubscribe","SerializableCipher","UNIVER_PROJECT","388499GswMTp","_permissionService","/rev/","salt","requireSession","JOIN_ROOM_FULL","map","image/jpg","state$","resourceIDs","_event$","transformUndoRedo","update","incrementRevOfUnit","objectActions","now","joinRsp","_doFinalize","EMAIL_VERIFY_CODE_MISMATCH","executeCommand","SHA1","randomBytes","image/bmp","_handlerCallback","actions","USERS_LEAVE","uploadFileServerUrl","every","putCollaborators","synced","_onFetchMissResult","/-/object/-/batch_allowed","fetch_missing","_unitInfo$","subject","HMAC","_onRemoteRejected","INVALID_INVITE_CODE","_onRemoteRetry","&source=","_prevBlock","clear","_sendHeartbeat","dispose","Pkcs7","liveShareNewHost","_retryCount","_sessions","LIVESHARE_FETCH_OPERATIONS","__creator","SOCKET_FAILED","JOIN_ROOM_PERMISSION_DENIED","OTHER_CLIENT_EDITING","reduce","readAsDataURL","UNKNOWN_CMD","_transformRemoteChangesetByStateCache","_getAPIPrefixPath","UNIVER_SLIDE","_sendingTimer","Malformed UTF-8 data","[UniverCollaborationClientPlugin]: you must provide a socketService implementation in config!","clamp","listRoles","charAt","add","_changesetSessionId","_pendingMutations","symbol","extend","_data","getCurrentRevOfUnit","_commandService","_keySchedule","APPLY_PERMISSION_DENIED","MD5","MUTATION","getSnapshotAPIPath","_parse","_socket$","commentUpdateEvent","_substituteUndoStack","UnitEmbedded","commentUpdate$","values","[ConflictState]: invalid calling to `resend`.","[OfflineState]: received rejection.","isArray","PSEUDO_FETCH_MISSING_RESULT","sin","focused$","_doProcessBlock","_members$","range","_exhaustRemoteChangesetQueue","onStarting","snapshot","CBC","BlockCipherMode","enableOfflineEditing","filter","objectType","resend","[serializeCombRequest]: should not fall into default branch!","state","IDLE","_clearScheduledTask","signUrlServerUrl","_collaborationTimeoutTimer","newCsEvent","_compressMutationService","session.room-permission-denied","updateOfflineData","PERMISSION_REJ","TOO_MANY_REQUESTS","__esModule",'you should override "IUndoRedoService" provided in "core" package!',"changesets","splice","HmacSHA1","_commentService","getUnitType","LICENSE_MAX_UNITS_EXCEEDED","HttpExport","INTERNAL_ERROR","_localeService","algo","CONNECTOR_DATA_TOO_LARGE","then","onload","hasOwnProperty","[OfflineState]: invalid calling to `resend`.","_getUploadFileURL","univer-pro.collaboration-client-socket-service","unpad","/universer-api/oidc/authpage","file","getCurrentUser","UNIVER_DOC","getAllMembers","includes","_networkConditionService","mixIn","USER_NOT_INVITED_CODE","abs","join","_applyRemoteChangeset","852820wQXtvz","[CollaborationEntity]: cannot lock transition twice! This is an implementation error, meaning you transit the collaboration state again in the process of a previous transition. This should never happen.","[OfflineState]: received changeset.","collaboration-client.config","substr","_collaborationUIEventService","patch","_collaborationPaused","snapshotServerUrl","type","Encryptor","getRandomValues","_init","RETRY_CONNECTING_MAX_COUNT","unitId is not found","error","[PendingState]: invalid calling to `resend`.","_HTTPService","FileId","collaboration_new_changeset","result","_roomCreated$","_scheduleCollaborationTimeoutTimer","fromCollab","_waitCount","_undoStacks","href","UNAUTHENTICATED","_isPermissionRej","mode","_createHelper","_map","name","_transformStateCache","params","CHANGESET_REJ","?url=","REMOTE_UNISCRIPT_EXECUTION_ENDPOINT","target","_minBufferSize","YUUMI_TABLE_NOT_FOUND_IN_UNIT","_keyPriorReset","clone","conflict","_showConflictNotification","_memberService","LOGIN_FAILED","createSocket","_configService","_candidateSocket","_state","failed to apply missed changesets!","fetchMissingChangesets","readInt32LE","_createSocket","reset","_getRedoStack","_transformService","/collaborator","_telemetryInfo","waitForRoom$","infoRsp","_telemetryService","duration","{fileID}","loadDoc","_unlockTransition","reject","_snapshotServerService","copyFileMeta","SUBMIT_CHANGESET","updatePermissionObjEvent","transformChangesets",'Could not dynamically require "',"18dKuBme","enc","EMAIL_HAS_BEEN_BOUND","asObservable","session","_onRecvEvent","BASE64","onlyLocal","auth.needGotoLoginAlert","_remoteChangesetQueue","_incrementRevisionNumber","1850965xpdDub","[CollaborationSessionService]: socket error","pluginName","_hash","_onRemoteACK","body","onTransformSelections","session.join-failed","createEncryptor"];return Q0=function(){return t},Q0()}function Ce(t,e){var x=i;const s=new rx(1);return setTimeout(()=>s.next(e),t),s[x(738)]()[x(1140)](A0(1))}const Yx={id:Je.id,type:Lt.MUTATION,params:{}};Object[i(838)];var R0=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},j=(t,e)=>(x,s)=>e(x,s,t),Te=(t=>(t[i(1232)]=i(1225),t[i(927)]=i(543),t[i(1177)]=i(1056),t.AWAITING=i(768),t[i(1031)]=i(1136),t[i(1150)]=i(546),t[i(1070)]=i(704),t[i(1192)]=i(762),t))(Te||{});const ye=6e4;class O0{constructor(e,x,s,r,n,a,o,c,f){var _=i;L(this,"_awaitingChangeset",null),L(this,"_pendingMutations",[]),this.unitID=e,this.type=x,this[_(1205)]=n,this[_(586)]=a,this[_(1149)]=o,this[_(1166)]=c,this[_(1025)]=f,this[_(1246)]=s,this[_(581)]=r}_checkMissing(e){var x=i;const s=this[x(1166)][x(585)](this.unitID);return e[x(938)]>s+1?(this._handler[x(1078)]({from:s,to:e[x(938)]-1}),!0):!1}[i(814)](e){var x=i;this._undoRedoService[x(525)](this[x(1114)],e)}[i(1100)](e){var x=i,s,r;(r=(s=this[x(1205)])[x(752)])==null||r[x(837)](s,e)}[i(1122)](e){var x=i,s,r;return(r=(s=this[x(1205)]).onTransformIME)==null?void 0:r[x(837)](s,e)}[i(694)](e){var x=i,s,r;return(r=(s=this[x(1205)])[x(1228)])==null?void 0:r[x(837)](s,e)}[i(904)](e){var x=i,s,r,n;return(n=(r=(s=this[x(1205)])[x(1096)])==null?void 0:r[x(837)](s,e))!=null?n:e}[i(570)](e){var x=i,s,r,n;return(n=(r=(s=this._handler)[x(871)])==null?void 0:r[x(837)](s,e))!=null?n:e}[i(1061)](e){var x=i,s,r;if(this[x(670)]===r0[x(652)]){const{unitID:n,mutations:a,memberID:o}=e,c=a[0][x(695)][x(980)];Array[x(601)](c)&&c[x(936)]>0&&((r=(s=this[x(1205)])[x(1081)])==null||r[x(837)](s,{unitID:n,memberID:o,textRanges:c}))}}[i(850)](){var e=i,x;(x=this._localCacheService)==null||x[e(626)](this[e(1114)],this.type,this[e(1246)],this[e(581)])}[i(1235)](){var e=i;return this[e(1166)][e(585)](this[e(1114)])}_incrementRevisionNumber(){var e=i;this[e(1166)][e(527)](this[e(1114)])}[i(1148)](e){var x=i,s;let r=this[x(904)](e);r=this[x(570)](r);const n=sx(r[x(501)],this[x(586)],{fromCollab:!0});if(!n[x(681)])throw n[x(676)]instanceof Error?n[x(676)]:new Error((s=n[x(676)])!=null?s:"[CollaborationState]: apply error!");this[x(1122)](r),this[x(694)](r),this._transformUndoredo(e),this._transformSelections(r),this._syncEditingCollabCursor(r),this[x(745)]()}}let P0=class extends O0{constructor(t,e,x,s,r,n,a,o,c,f){var _=i;super(t,e,null,[],x,a,n,s,f),L(this,_(917),_(543)),this[_(819)]=r,this[_(1038)]=o,this[_(718)]=c,this[_(1053)]=f}appendMutation(t){var e=i;const x=this._injector[e(1174)](f0,this[e(1114)],this[e(670)],[t],this[e(1205)]);return x[e(756)](),x[e(850)](),x}[i(1098)](t){var e=i;if(this._checkMissing(t))return this._injector[e(1174)](n0,this[e(1114)],this[e(670)],null,[],null,[t],this[e(1205)]);try{const x=this._transformService[e(877)](t,[Yx]);if($0(x)){const{c1Prime:s}=x;return this[e(1148)](s),this}throw x.error}catch(x){return this[e(1038)][e(676)](x),this[e(1201)](!1)}}[i(1201)](t){var e=i;return this[e(819)][e(1174)](p0,this[e(1114)],this[e(670)],null,[],this[e(1205)],t)}[i(1023)](){var t=i;throw new Error(t(1086))}[i(1244)](){var t=i;throw new Error(t(493))}[i(956)](){return this}[i(1103)](){var t=i;return this[t(819)][t(1174)](E0,this.unitID,this.type,null,[],this[t(1205)])}toggleOnline(){return this}resend(){var t=i;throw new Error(t(880))}[i(804)](){var t=i;const e=this[t(1166)][t(585)](this.unitID);return this[t(1205)][t(1078)]({from:e,to:0}),this._injector[t(1174)](n0,this.unitID,this[t(670)],null,[],null,[],this[t(1205)])}};P0=R0([j(3,k(a0)),j(4,k(X)),j(5,u0),j(6,e0),j(7,Q),j(8,y0),j(9,W(i0))],P0);let f0=class extends O0{constructor(t,e,x,s,r,n,a,o,c,f,_,l,h,v){var p=i;super(t,e,null,x,s,c,h,n,v),L(this,p(917),p(1056)),L(this,p(1108),null),L(this,p(573),null),this[p(819)]=r,this._memberService=a,this[p(1038)]=o,this[p(709)]=f,this._transformService=_,this._univerInstanceService=l}appendMutation(t){var e=i;return this._pendingMutations[e(944)](t),this[e(850)](),this}[i(1098)](t){var e=i;if(this._checkMissing(t))return this[e(620)](),this[e(819)][e(1174)](n0,this[e(1114)],this.type,null,this[e(581)],null,[t],this[e(1205)]);try{const x=this[e(718)].transformMutationsWithChangeset(t,this[e(581)]);if($0(x)){const{c1Prime:s,m2Prime:r}=x;this[e(1148)](s);const n=this[e(819)][e(1174)](f0,this[e(1114)],this[e(670)],r,this._handler);this._clearScheduledTask();const a=new Date()[e(1115)](),o=this[e(1108)]?Math[e(1002)](this._scheduleCompleteTimestamp-a,0):this._getSendChangesetTimeout();return n._schedule(o),n}throw x[e(676)]}catch(x){return this._logService.error(x),this[e(1201)](!1)}}[i(1023)](){var t=i;throw new Error(t(895))}[i(1244)](){var t=i;throw new Error(t(1221))}onRemoteRetry(){return this}[i(1103)](){var t=i;return this._clearScheduledTask(),this[t(819)][t(1174)](E0,this[t(1114)],this[t(670)],null,this[t(581)],this[t(1205)])}[i(935)](){return this}_schedule(t){var e=i;const x=t??this[e(1101)]();this._scheduleCompleteTimestamp=new Date()[e(1115)]()+x,this[e(573)]=setTimeout(()=>{var s=e;this[s(620)]();let r=null;switch(this[s(670)]){case r0[s(1171)]:{r=qt(this._pendingMutations,this[s(1114)],this[s(817)],this._revisionService,this[s(706)]);break}case r0[s(652)]:{this[s(581)][s(541)](c=>c.id===ve.id)?r=Gx(this._pendingMutations,this[s(1114)],this[s(817)],this[s(1166)],this._memberService):r=qt(this._pendingMutations,this.unitID,this[s(817)],this[s(1166)],this[s(706)]);break}default:throw new Error(s(1009)+this[s(670)]+s(847))}const{changeset:n,pendingMutations:a}=r;this[s(1205)][s(997)](n);const o=a[s(936)]?this[s(819)].createInstance(d0,this.unitID,this[s(670)],n,a,this[s(1205)],void 0):this[s(819)][s(1174)](m0,this[s(1114)],this[s(670)],n,this[s(1205)]);o[s(850)](),this[s(1205)][s(492)](this,o)},x)}[i(1101)](){var t=i,e;const x=this[t(709)].getConfig(t0);return(e=x?.[t(510)])!=null?e:yx}[i(616)](){var t=i;throw new Error(t(677))}[i(620)](){var t=i;this[t(573)]!=null&&(clearTimeout(this[t(573)]),this[t(573)]=null)}[i(1201)](t){var e=i;return this[e(620)](),this._injector[e(1174)](p0,this[e(1114)],this[e(670)],null,this[e(581)],this[e(1205)],t)}};f0=R0([j(4,k(X)),j(5,k(a0)),j(6,k(B0)),j(7,Q),j(8,e0),j(9,x0),j(10,y0),j(11,S0),j(12,u0),j(13,W(i0))],f0);let m0=class extends O0{constructor(t,e,x,s,r,n,a,o,c,f,_){var l=i;super(t,e,x,[],s,a,f,n,_),L(this,l(917),"awaiting"),L(this,l(899),0),L(this,l(1012)),L(this,l(890)),this[l(819)]=r,this[l(1038)]=o,this._transformService=c}[i(873)](t){var e=i;this[e(620)]();const x=this[e(819)][e(1174)](d0,this[e(1114)],this[e(670)],this[e(1246)],[t],this[e(1205)],this[e(1012)]);return x[e(850)](),x}[i(1098)](t){var e=i;if(this[e(1247)](t))return this._clearScheduledTask(),this[e(819)][e(1174)](n0,this[e(1114)],this[e(670)],this[e(1246)],[],null,[t],this._handler);try{const x=this[e(718)].transformChangesets([t],[this[e(1246)]],!1);if(Pt(x)){const{c1Prime:s,c2Prime:r}=x;this._executeRemoteChangeset(s[0]),r[0][e(829)]=this[e(1235)](),this[e(620)]();const n=this[e(819)][e(1174)](m0,this[e(1114)],this[e(670)],r[0],this[e(1205)]);return n[e(850)](),n}return this._onConflict(!1)}catch(x){return this._logService.error(x),this[e(1201)](!1)}}[i(1023)](t){var e=i;this[e(620)]();const x=this[e(1166)][e(585)](this[e(1114)]);if(t[e(938)]<x-1)return this;if(this._checkMissing(t))return this._injector[e(1174)](n0,this.unitID,this[e(670)],null,[],this[e(1246)],[],this._handler);this[e(745)]();const s=this[e(819)][e(1174)](P0,this[e(1114)],this.type,this._handler);return s[e(850)](),s}onRemoteRej(t){var e=i;return this[e(1201)](!!(t!=null&&t[e(874)]))}[i(956)](t){var e=i;return this[e(899)]>ye?this[e(1103)]():(this[e(1012)]=Ce(this._resendTimeout,{timeout:this._resendTimeout,reqId:t.reqId}),this._sender=this._resendTimer[e(982)](({reqId:x,timeout:s})=>{var r=e;this[r(1068)](x,s)}),this)}[i(1103)](){var t=i;return this[t(620)](),this._injector.createInstance(E0,this[t(1114)],this[t(670)],this[t(1246)],[],this._handler)}toggleOnline(){return this}[i(616)](){var t=i;this[t(1205)][t(997)](this[t(1246)])}[i(1201)](t){var e=i;return this[e(620)](),this[e(819)][e(1174)](p0,this[e(1114)],this[e(670)],this[e(1246)],[],this[e(1205)],t)}[i(1068)](t,e){var x=i,s;t===((s=this._awaitingChangeset)==null?void 0:s.reqId)&&(this[x(616)](),this[x(899)]=e===0?1e3:e*2)}_clearScheduledTask(){var t=i,e;(e=this[t(890)])==null||e[t(511)](),this._resendTimeout=0}};m0=R0([j(4,k(X)),j(5,k(a0)),j(6,e0),j(7,Q),j(8,y0),j(9,u0),j(10,W(i0))],m0);let d0=class extends O0{constructor(t,e,x,s,r,n,a,o,c,f,_,l,h){var v=i;super(t,e,x,s,r,c,l,o,h),L(this,v(917),v(1136)),L(this,v(899),0),L(this,"_resendTimer"),L(this,v(890)),this[v(819)]=a,this[v(1038)]=f,this[v(718)]=_,this[v(1053)]=h,n&&(this[v(1012)]=n,this[v(890)]=this[v(1012)][v(982)](({reqId:p,timeout:C})=>{var D=v;this[D(1068)](p,C)}))}[i(873)](t){var e=i;return this[e(581)][e(944)](t),this}[i(1098)](t){var e=i;if(this[e(1247)](t))return this[e(620)](),this[e(819)][e(1174)](n0,this[e(1114)],this.type,this[e(1246)],this[e(581)],null,[t],this._handler);try{const x=this._transformService[e(733)]([t],[this[e(1246)]],!1);if(Pt(x)){const{c1Prime:s,c2Prime:r}=x,n=this._transformService.transformMutationsWithChangeset(s[0],this[e(581)]);if($0(n)){const{c1Prime:a,m2Prime:o}=n;return this[e(1148)](a),r[0][e(829)]=this[e(1235)](),this[e(620)](),this[e(819)][e(1174)](d0,this[e(1114)],this[e(670)],r[0],o,this[e(1205)],void 0)}throw n[e(676)]}throw x[e(676)]}catch(x){return this[e(1038)][e(676)](x),this._onConflict(!1)}}[i(1023)](t){var e=i;if(this[e(620)](),this[e(1247)](t))return this[e(819)][e(1174)](n0,this.unitID,this.type,null,this[e(581)],this[e(1246)],[],this[e(1205)]);this[e(745)]();const x=this[e(819)][e(1174)](f0,this[e(1114)],this[e(670)],this[e(581)],this[e(1205)]);return x._schedule(),x[e(850)](),x}onRemoteRej(t){var e=i;return this[e(1201)](!!(t!=null&&t[e(874)]))}[i(956)](t){var e=i;return this[e(899)]>ye?this.toggleOffline():(this._resendTimer=Ce(this[e(899)],{timeout:this[e(899)],reqId:t[e(1017)]}),this[e(890)]=this._resendTimer[e(982)](({reqId:x,timeout:s})=>{this._resendWithTimeout(x,s)}),this)}toggleOffline(){var t=i;return this[t(620)](),this[t(819)][t(1174)](E0,this[t(1114)],this[t(670)],this[t(1246)],this[t(581)],this._handler)}[i(935)](){return this}resend(){var t=i;this[t(1205)].onSendChangeset(this[t(1246)])}[i(1201)](t){var e=i;return this._clearScheduledTask(),this._injector.createInstance(p0,this[e(1114)],this[e(670)],null,this[e(581)],this[e(1205)],t)}_resendWithTimeout(t,e){var x=i,s;t===((s=this._awaitingChangeset)==null?void 0:s[x(1017)])&&(this.resend(),this[x(899)]=e===0?1e3:e*2)}[i(620)](){var t=i,e;(e=this[t(890)])==null||e[t(511)](),this[t(899)]=0}};d0=R0([j(6,k(X)),j(7,k(a0)),j(8,e0),j(9,Q),j(10,y0),j(11,u0),j(12,W(i0))],d0);let p0=class extends O0{constructor(t,e,x,s,r,n=!1,a,o,c,f,_,l,h){var v=i;super(t,e,x,s,r,o,c,f,h),L(this,"status",v(704)),this[v(689)]=n,this._permissionService=a,this[v(639)]=_,this[v(666)]=l,this.localCacheService=h,this[v(705)](),this[v(994)](),this._disableEditing()}[i(873)](){return this}[i(1098)](){return this}[i(1023)](){return this}[i(1244)](){return this}[i(956)](){return this}[i(1103)](){return this}[i(935)](){return this}[i(616)](){var t=i;throw new Error(t(599))}[i(994)](){var t=i,e;(e=this[t(1025)])==null||e[t(626)](this[t(1114)],this[t(670)],null,[])}_showConflictNotification(){var t=i;this[t(689)]?this[t(666)][t(782)]({id:l0[t(500)]}):this[t(666)].emitEvent({id:l0[t(1070)]})}_disableEditing(){var t=i;this[t(515)][t(1106)](new q0(this[t(1114)]).id,!1)}};p0=R0([j(6,k(G0)),j(7,e0),j(8,u0),j(9,k(a0)),j(10,k(Y0)),j(11,k(g0)),j(12,W(i0))],p0);let E0=class extends O0{constructor(t,e,x,s,r,n,a,o,c,f){var _=i;super(t,e,x,s,r,o,c,a,f),L(this,_(917),_(762)),this[_(819)]=n}[i(873)](t){var e=i;return this._pendingMutations.push(t),this[e(850)](),this}[i(1098)](t){var e=i;throw new Error(e(663))}[i(1023)](){throw new Error("[OfflineState]: received acknowledgement.")}onRemoteRej(){var t=i;throw new Error(t(600))}[i(956)](){return this}[i(1103)](){return this}[i(935)](){var t=i;const{_injector:e,_pendingMutations:x,_awaitingChangeset:s,unitID:r,_handler:n,type:a}=this,o=Re(e,r,a,s,x,n);return o instanceof f0?o[t(756)]():(o instanceof d0||o instanceof m0)&&o[t(616)](),o}[i(616)](){var t=i;throw new Error(t(645))}};E0=R0([j(5,k(X)),j(6,k(a0)),j(7,e0),j(8,u0),j(9,W(i0))],E0);let n0=class extends O0{constructor(t,e,x,s,r,n,a,o,c,f,_,l,h,v){var p=i;super(t,e,x,s,a,_,l,c,v),L(this,p(917),"fetch_missing"),this[p(888)]=r,this[p(1110)]=n,this[p(819)]=o,this[p(1038)]=f,this[p(718)]=h,this[p(1053)]=v}[i(966)](t){var e=i;try{const x=[...t,...this[e(1110)]],s=[this._awaitingChangeset||this[e(888)]][e(614)](c=>!!c);let r,n;if(s[e(936)]){const c=this[e(718)][e(733)](x,s,!1);if(!Pt(c))throw c[e(676)];r=c[e(1145)],n=c.c2Prime}else r=x,n=[];let a=this._pendingMutations;r[e(962)](c=>{var f=e;let _;if(a.length){const l=this._transformService[f(877)](c,a);if(!$0(l))throw l[f(676)];_=l[f(1145)],a=l[f(852)]}else _=c;this[f(1148)](_)}),this._acknowledgedAwaitingChangeset&&this._incrementRevisionNumber(),this[e(1246)]&&n[e(936)]&&(n[0].baseRev=this[e(1235)]());let o;if(this[e(1246)]&&a[e(936)]!==0)o=this._injector[e(1174)](d0,this.unitID,this[e(670)],n[0],a,this[e(1205)],void 0);else if(this[e(1246)]&&a[e(936)]===0)n[0][e(829)]=this[e(1235)](),o=this[e(819)][e(1174)](m0,this[e(1114)],this.type,n[0],this[e(1205)]);else if(a[e(936)]!==0){const c=this[e(819)][e(1174)](f0,this[e(1114)],this[e(670)],a,this._handler);c[e(756)](),o=c}else o=this._injector[e(1174)](P0,this[e(1114)],this[e(670)],this[e(1205)]);return o[e(850)](),o}catch(x){return this._logService[e(676)](e(923),e(712),x),this._injector[e(1174)](p0,this[e(1114)],this[e(670)],this[e(1246)],this._pendingMutations,this[e(1205)],!1)}}[i(616)](){var t=i;throw new Error(t(825))}[i(873)](t){var e=i;return this[e(581)][e(944)](t),this}[i(1098)](t){var e=i;return this[e(1110)][e(944)](t),this}[i(1023)](t){var e=i;if(this[e(1246)])return this[e(888)]=this[e(1246)],this[e(1246)]=null,this;throw new Error("[FetchingMissState]: not expected to receive ack when `this._awaitingChangeset` is null!")}[i(1244)](t){var e=i;return this[e(1201)](!!(t!=null&&t[e(874)]))}[i(956)](){return this}[i(1103)](){var t=i;return this[t(819)].createInstance(E0,this.unitID,this[t(670)],this[t(1246)],this[t(581)],this[t(1205)])}[i(935)](){return this}[i(1201)](t){var e=i;return this[e(819)].createInstance(p0,this[e(1114)],this[e(670)],this[e(1246)],this[e(581)],this[e(1205)],t)}};n0=R0([j(7,k(X)),j(8,k(a0)),j(9,Q),j(10,e0),j(11,u0),j(12,y0),j(13,W(i0))],n0);function Re(t,e,x,s,r,n){var a=i;return s&&r[a(936)]?t[a(1174)](d0,e,x,s,r,n,void 0):s?t[a(1174)](m0,e,x,s,n):r.length?t[a(1174)](f0,e,x,r,n):t[a(1174)](P0,e,x,n)}Object[i(838)];var Ht=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},Y=(t,e)=>(x,s)=>e(x,s,t);let Z0=class extends V0{constructor(t,e,x,s,r,n,a,o,c,f,_,l,h){var v=i;super(),L(this,"_state$",new M0(null)),L(this,v(522),this[v(1116)].asObservable()),L(this,v(711)),L(this,"_collaborationPaused",!1),L(this,v(580),""),L(this,v(925),0),L(this,v(820),this[v(522)][v(1140)](c0(p=>p?p.status:Te.OFFLINE),He(1))),L(this,v(1088),!1),L(this,v(744),[]),this.unitID=t,this[v(739)]=e,this._type=x,this[v(819)]=s,this[v(624)]=r,this[v(639)]=n,this[v(1166)]=a,this._eventService=o,this[v(1038)]=c,this._commandService=f,this[v(515)]=_,this[v(887)]=l,this[v(1025)]=h}get[i(618)](){var t=i;return this[t(711)]}async[i(958)](){var t=i;if(this.state)throw new Error(t(910));await this[t(673)]()}[i(1178)](){var t=i;return this[t(668)]=!0,J0(()=>{var e=t;this[e(668)]=!1,this._exhaustRemoteChangesetQueue()})}[i(981)](t){var e=i;this[e(892)](t)}[i(771)](t){var e=i;this[e(711)]=t,this[e(1116)][e(949)](t)}async _init(){var t=i,e;this[t(771)](await this[t(954)]()),this[t(887)]&&((e=this[t(887)])==null||e[t(974)](this[t(1114)]),this[t(879)](this[t(887)][t(1054)](this[t(1114)])[t(982)](s=>{var r=t;this[r(1038)].debug(r(798),r(1183),s),s===ge[r(878)]?(this._eventService[r(782)]({id:l0[r(566)]}),this[r(515)][r(1106)](new q0(this.unitID).id,!1),this[r(515)].setShowComponents(!1)):(this._permissionService.updatePermissionPoint(new q0(this[r(1114)]).id,!0),this[r(515)][r(1208)](!0))})));let x=!1;return this[t(879)](this[t(739)].sessionStatus$[t(982)](s=>{var r=t;s===T0.ONLINE?this[r(952)](x):s===T0[r(1192)]&&(x=!0,this[r(991)]())})),this[t(879)](this.session[t(1160)][t(982)](s=>{var r=t;try{switch(s[r(903)]){case H[r(855)]:{this._onRemoteChangeset(jt(s[r(1080)]));break}case H.CHANGESET_ACK:{this[r(750)](s.data);break}case H.CHANGESET_REJ:{this[r(550)]();break}case H.CHANGESET_SHOULD_RETRY:{this._onRemoteRetry(s[r(1080)]);break}case H[r(602)]:{this[r(544)](s[r(1080)][r(631)].map(n=>jt(n)));break}case H[r(627)]:{this._onRemoteRejected({isPermissionRej:!0});break}case H[r(967)]:break}}catch(n){throw console[r(676)](r(813),n),n}})),this[t(711)]}_unlockTransition(){var t=i;this[t(1088)]=!1}_lockTransition(){var t=i;if(this[t(1088)])throw new Error(t(662));this[t(1088)]=!0}[i(892)](t){var e=i;this[e(1092)](),this._updateState(this[e(711)].appendMutation(t)),this._unlockTransition()}_onRemoteChangeset(t){var e=i;if(!(t[e(938)]<=this[e(1166)][e(585)](this.unitID))){if(this._collaborationPaused){this[e(744)][e(944)](t);return}this[e(660)](t)}}[i(608)](){var t=i;this[t(744)].forEach(e=>this._applyRemoteChangeset(e)),this[t(744)]=[]}_applyRemoteChangeset(t){var e=i;const x=this[e(624)][e(796)][e(828)](this._compressMutationService[e(796)].getInterceptPoints().COMPRESS_MUTATION_APPLY)(t[e(501)],null)||t.mutations,s={...t,mutations:x};this[e(1092)](),this[e(771)](this[e(711)].onRemoteChangeset(s)),this[e(727)]()}[i(750)](t){var e=i;this._lockTransition(),this[e(771)](this[e(711)][e(1023)](t)),this._unlockTransition()}[i(550)](t){var e=i;this[e(1092)](),this[e(771)](this[e(711)][e(1244)](t)),this._unlockTransition()}[i(552)](t){var e=i;this[e(1092)](),this._updateState(this._state[e(956)](t)),this[e(727)]()}[i(544)](t){var e=i;if(!(this[e(711)]instanceof n0))throw new TypeError(e(487));const x=t[e(520)](s=>{var r=e;const n=this[r(624)][r(796)][r(828)](this[r(624)][r(796)].getInterceptPoints()[r(801)])(s[r(501)],null)||s[r(501)];return{...s,mutations:n}});this[e(1092)](),this[e(771)](this[e(711)].onMissedChangesetFetched(x)),this._unlockTransition()}[i(991)](){var t=i;this[t(1092)](),this._updateState(this[t(711)][t(1103)]()),this[t(727)]()}[i(952)](t=!1){var e=i;this[e(1092)](),this._updateState(this._state[e(935)]()),this[e(727)]();const x=this[e(711)];t&&x instanceof P0&&(this[e(1092)](),this[e(771)](x.fetchMiss()),this[e(727)]())}async _createInitialState(){return new Promise(t=>{var e=$;this[e(739)][e(823)].pipe(A0(1)).subscribe(async x=>{var s=e;t(await this._createInitialStateImpl(x===T0[s(1018)]))})})}_createHandler(){var t=i;const e=this[t(1114)];return{onStateChange:(x,s)=>{var r=t;if(x!==this[r(711)])throw new Error(`[CollaborationEntity]: invalid state transition! State transferred from is not the current state.
Before: `+x[r(917)]+r(869)+s[r(917)]+r(1049)+this._state.status);this._updateState(s)},onSendChangeset:x=>{var s=t;x[s(836)]||(x[s(836)]=this[s(580)],x.reqId=++this[s(925)]);const r={eventID:H[s(731)],data:{unitID:x[s(1114)],unitType:this[s(1043)],changeset:x,memberID:this[s(739)][s(975)]()}};this.session[s(851)](r,this[s(1114)])},onMissingChangesets:({from:x,to:s})=>{var r=t;this._logService[r(876)]("[CollaborationEntity]",r(846)+x+r(1066)+s);const n={eventID:H[r(1195)],data:{unitID:e,unitType:this[r(1043)],from:x,to:s}};this.session[r(851)](n,this.unitID)}}}async _createInitialStateImpl(t){var e=i,x,s,r;const n=await((x=this._localCacheService)==null?void 0:x.loadOfflineData(this[e(1114)])),a=(s=n?.mutations)!=null?s:[],o=(r=n?.[e(1030)])!=null?r:null,c=!!(o!=null&&o.sid)&&!!(o!=null&&o[e(1017)]);this[e(580)]=c?o.sid:je(),this[e(925)]=c?o[e(1017)]:0;const f=this[e(1114)];try{this._replayCachedMutations(o,a)}catch(l){this[e(1038)].error(l)}const _=this[e(915)]();if(t){const l=Re(this._injector,f,this[e(1043)],o,a,_);return l instanceof f0?l[e(756)]():(l instanceof d0||l instanceof m0)&&l.resend(),l}return this[e(819)][e(1174)](E0,f,this[e(1043)],o,a,_)}[i(818)](t,e){var x=i,s,r;const n=this._compressMutationService[x(796)][x(828)](this._compressMutationService[x(796)].getInterceptPoints()[x(801)]);(s=n(t?.[x(501)]||[],null))==null||s[x(962)](a=>this[x(586)].executeCommand(a.id,a.params)),(r=n(e||[],null))==null||r[x(962)](a=>this[x(586)][x(533)](a.id,a.params))}};Z0=Ht([Y(3,k(X)),Y(4,k(kt)),Y(5,k(Y0)),Y(6,k(a0)),Y(7,k(g0)),Y(8,Q),Y(9,e0),Y(10,G0),Y(11,W(rt)),Y(12,W(i0))],Z0);let vt=class extends Z0{constructor(t,e,x,s,r,n,a,o,c,f,_,l,h){var v=i;super(t,x,e,s,r,n,a,o,c,f,_,l,h),L(this,v(537),null),this[v(1114)]=t,this.type=e}addHandlerCallback(t){var e=i;this[e(537)]=t}[i(557)](){var t=i;this[t(537)]=null,super[t(557)]()}[i(915)](){var t=i;const e=super._createHandler();return e[t(1087)]=x=>{var s=t,r,n;return(n=(r=this[s(537)])==null?void 0:r[s(1087)])==null?void 0:n.call(r,x)},e[t(1228)]=x=>{var s=t,r,n;return(n=(r=this[s(537)])==null?void 0:r[s(1228)])==null?void 0:n[s(837)](r,x)},e[t(752)]=x=>{var s=t,r,n;return(n=(r=this[s(537)])==null?void 0:r.onTransformSelections)==null?void 0:n[s(837)](r,x)},e[t(1081)]=x=>{var s=t,r,n;return(n=(r=this[s(537)])==null?void 0:r[s(1081)])==null?void 0:n[s(837)](r,x)},e.onTransformRemoteChangesetByIMECache=x=>{var s=t,r,n,a;if(!((r=this[s(537)])!=null&&r[s(1096)]))throw new Error(s(1252));return(a=(n=this[s(537)])==null?void 0:n[s(1096)])==null?void 0:a[s(837)](n,x)},e.onTransformRemoteChangesetByStateCache=x=>{var s=t,r,n,a;if(!((r=this._handlerCallback)!=null&&r[s(871)]))throw new Error("onTransformRemoteChangesetByStateCache callback is not added yet.");return(a=(n=this._handlerCallback)==null?void 0:n[s(871)])==null?void 0:a[s(837)](n,x)},e}async _init(){var t=i;const e=await super[t(673)]();return this[t(879)](this[t(586)][t(1159)]((x,s)=>{var r=t;if(x[r(670)]!==Lt[r(590)]||s!=null&&s[r(684)]||s!=null&&s.onlyLocal||x.id===ve.id)return;const n=x.params;if(n?.[r(1142)]!==this[r(1114)])return;const a=x,o=this[r(624)][r(796)][r(828)](this[r(624)][r(796)][r(1107)]().COMPRESS_MUTATION_SEND)([a],null)||[a];this[r(892)](o[0])})),e}};vt=Ht([Y(3,k(X)),Y(4,k(kt)),Y(5,k(Y0)),Y(6,k(a0)),Y(7,k(g0)),Y(8,Q),Y(9,e0),Y(10,G0),Y(11,W(rt)),Y(12,W(i0))],vt);let _t=class extends Z0{constructor(t,e,x,s,r,n,a,o,c,f,_,l,h,v){var p=i;super(t,x,e,s,r,n,a,c,f,_,l,h,v),this[p(1114)]=t,this[p(670)]=e,this[p(1047)]=o}[i(915)](){var t=i;const e=super[t(915)]();return e[t(752)]=x=>this[t(1047)].transformSelections(x),e}async[i(673)](){var t=i;const e=await super[t(673)]();return this.disposeWithMe(this[t(586)][t(1159)]((x,s)=>{var r=t;if(x[r(670)]!==Lt[r(590)]||s!=null&&s[r(684)]||s!=null&&s[r(742)])return;const n=x[r(695)];if(n?.unitId!==this[r(1114)])return;const a=x,o=this._compressMutationService[r(796)][r(828)](this[r(624)][r(796)][r(1107)]().COMPRESS_MUTATION_SEND)([a],null)||[a];this[r(892)](o[0])})),e}};_t=Ht([Y(3,k(X)),Y(4,k(kt)),Y(5,k(Y0)),Y(6,k(a0)),Y(7,k(X0)),Y(8,k(g0)),Y(9,Q),Y(10,e0),Y(11,G0),Y(12,W(rt)),Y(13,W(i0))],_t);const Kx=st("univer-pro.collaboration-client.network-condition.service");function zx(t){var e=i,x,s,r,n,a;const o=t[e(1080)],c=JSON[e(918)](o);switch(c[e(1213)]){case J[e(1004)]:case J.HELLO:{const f=c[e(722)];return{...c,data:f,cmd:c[e(1213)]}}case J[e(1143)]:{const f=c[e(530)];return{...c,data:f,cmd:c.cmd}}case J[e(951)]:{const f=c.collaMsg;switch(f[e(903)]){case H.PERMISSION_REJ:return{...c,data:{...f,data:(x=f[e(924)])==null?void 0:x.cs},cmd:c.cmd};case H.CHANGESET_ACK:return{...c,data:{...f,data:(s=f.csAckEvent)==null?void 0:s.cs},cmd:c.cmd};case H[e(855)]:return{...c,data:{...f,data:(r=f[e(623)])==null?void 0:r.cs},cmd:c[e(1213)]};case H[e(696)]:return{...c,data:{...f,data:(n=f.csRejEvent)==null?void 0:n.cs},cmd:c[e(1213)]};case H[e(856)]:return{...c,data:{...f,data:(a=f[e(914)])==null?void 0:a.cs},cmd:c.cmd};case H[e(921)]:return{...c,data:{...f,data:f.updateCursorEvent},cmd:c.cmd};case H[e(884)]:return{...c,data:{...f,data:f[e(1175)]},cmd:c.cmd};case H.USERS_LEAVE:return{...c,data:{...f,data:f[e(979)]},cmd:c[e(1213)]};case H[e(965)]:return{...c,data:{...f,data:f[e(559)]},cmd:c[e(1213)]};case H.LIVESHARE_FETCH_OPERATIONS:case H.LIVESHARE_OPERATION:return{...c,data:{...f,data:f[e(930)]},cmd:c[e(1213)]};case H[e(797)]:return{...c,data:{...f,data:f[e(559)]},cmd:c.cmd};case H.MSG_FOR_ERROR:return{...c,data:f,cmd:c[e(1213)]};case H[e(1179)]:return{...c,data:{...f,data:f[e(594)]},cmd:c.cmd};case H[e(928)]:return{...c,data:{...f,data:f[e(732)]},cmd:c[e(1213)]};case H[e(1050)]:return{...c,data:{...f,data:f[e(1155)]},cmd:c.cmd};case H.UNISCRIPT_RUN:return{...c,data:{...f,data:f[e(1251)]},cmd:c[e(1213)]};default:return c}}default:return c}}function Jx(t){var e=i;switch(t[e(1213)]){case J[e(1004)]:case J[e(1021)]:return JSON[e(1220)]({cmd:t.cmd,routeKey:t[e(931)]});case J[e(866)]:{let x;switch(t.data[e(903)]){case H[e(921)]:{x={eventID:H[e(921)],updateCursorEvent:t[e(1080)].data};break}case H[e(539)]:{x={eventID:H[e(539)],leaveEvent:t[e(1080)].data};break}case H.USERS_ENTER:{x={eventID:H[e(884)],joinEvent:t.data[e(1080)]};break}case H[e(965)]:{x={eventID:H[e(965)],liveShareNewHost:t.data[e(1080)]};break}case H.LIVESHARE_OPERATION:{x={eventID:H[e(779)],liveShareOperation:t.data[e(1080)]};break}case H[e(797)]:{x={eventID:H[e(797)],liveShareTerminate:t.data[e(1080)]};break}case H.LIVESHARE_REQUEST_HOST:{x={eventID:H.LIVESHARE_REQUEST_HOST,liveShareRequestHost:t[e(1080)][e(1080)]};break}case H[e(562)]:{x={eventID:H[e(562)]};break}default:x={eventID:t[e(1080)].eventID}}return JSON.stringify({cmd:t[e(1213)],routeKey:t[e(931)],collaMsg:x})}case J[e(1143)]:return JSON[e(1220)]({cmd:t[e(1213)],routeKey:t.routeKey,joinReq:t[e(1080)]});case J.LEAVE:return JSON[e(1220)]({cmd:t[e(1213)],routeKey:t.routeKey,leaveReq:t[e(1080)]});default:throw new Error(e(617))}}Object[i(838)];var Wx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},k0=(t,e)=>(x,s)=>e(x,s,t);const Oe=st(i(647));function qx(t,e,x){return t+"/"+e+"/unit/"+x+"/new_changes"}let Xt=class extends L0{constructor(t,e,x,s,r){var n=i;super(),this[n(819)]=t,this[n(788)]=e,this._configService=x,this._logService=s,this[n(729)]=r}[i(1131)](t){var e=i;const x=this._injector[e(1071)](Fe);if(!x)throw new Error(e(1134));const s=x.createSocket(t);if(!s)throw new Error(e(959));const r=new $e,n=new h0;r[e(579)](s[e(940)].subscribe(_=>n[e(949)](_))),r.add(J0(()=>n[e(1196)]()));const a=new h0;r[e(579)](s[e(509)][e(982)](_=>a[e(949)](_))),r[e(579)](J0(()=>a[e(1196)]()));const o=new h0;r[e(579)](s[e(1215)].subscribe(_=>{var l=e;const h=zx(_);o[l(949)](h)})),r[e(579)](J0(()=>o[e(1196)]()));let c;const f=()=>{var _=e;a[_(949)](new Event("connection error")),n.next(new Event(_(897))),c[_(993)]()};return c={memberID:"",close$:n.asObservable(),error$:a[e(738)](),open$:s[e(1123)],message$:o.asObservable(),send:_=>{var l=e;if(_.cmd===J[l(866)]){if(_[l(1080)].eventID===H.SUBMIT_CHANGESET){this[l(908)](c,_[l(1080)])[l(1003)](h=>{var v=l;this[v(1038)][v(676)](h),f()});return}if(_.data[l(903)]===H[l(1195)]){const h=_[l(1080)];this._fetchMissChangesets(h)[l(642)](v=>{var p=l;o.next({cmd:J.RECV,code:C0.OK,routeKey:h[p(1080)][p(1114)],routeType:"",data:{eventID:H[p(602)],data:{changesets:v}}})})[l(1003)](v=>{var p=l;this[p(1038)][p(676)](v),f()});return}}s[l(851)](Jx(_))},close:()=>{var _=e;s[_(993)](),r[_(557)]()}},c}async[i(908)](t,e){var x=i,s;const{unitType:r,unitID:n,changeset:a}=e[x(1080)],o={unitID:n,memberID:t[x(1105)],type:r,changeset:Ve(a)},c=this._configService.getConfig(t0),f=qx((s=c?.[x(1147)])!=null?s:Ax,r,n);try{await this[x(788)][x(1067)](f,{body:o})}catch(_){throw this[x(1038)].error(x(989),x(1089)),_}}async _fetchMissChangesets(t){var e=i;const{unitID:x,from:s,to:r,unitType:n}=t[e(1080)];return(await this._snapshotServerService[e(713)]({metadata:void 0},{unitID:x,type:n,from:s,to:r})).changesets}};Xt=Wx([k0(0,k(X)),k0(1,k(I0)),k0(2,x0),k0(3,Q),k0(4,_e)],Xt);Object[i(838)];var Xx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},D0=(t,e)=>(x,s)=>e(x,s,t);let F0=class extends L0{constructor(t,e,x,s,r,n){var a=i;super(),L(this,a(593),new M0(void 0)),L(this,"socket$",this[a(593)][a(738)]()),L(this,a(710),null),L(this,a(561),new Map),L(this,a(891),new M0(T0[a(619)])),L(this,"status$",this[a(891)].asObservable()),L(this,"_socketReady",!1),L(this,a(1186)),L(this,a(560),0),L(this,a(1203)),L(this,a(999)),this[a(819)]=t,this[a(1038)]=e,this[a(709)]=x,this[a(1032)]=s,this[a(666)]=r,this[a(655)]=n,this[a(1041)]()}get[i(830)](){var t=i;return this[t(593)].getValue()}[i(1041)](){var t=i;this._networkConditionService&&this.disposeWithMe(this._networkConditionService[t(1227)][t(982)](e=>{var x=t;e&&!this[x(830)]&&this[x(1117)](),e||this[x(790)]()}))}dispose(){var t=i;super.dispose(),this[t(1188)](),this[t(1015)](),this[t(1185)](),this[t(561)][t(962)](e=>e.dispose()),this._sessions.clear(),this[t(891)].complete()}async[i(518)](t){var e=i;if(this[e(561)][e(1112)](t))return this[e(561)][e(1071)](t);this[e(995)]();const x=this[e(819)][e(1174)](dt,t,this[e(593)][e(738)]());return this._sessions[e(839)](t,x),x}[i(1006)](t){var e=i,x;const s=this._sessions[e(1071)](t);s&&(this[e(561)][e(1127)](t),s[e(993)]()),this._sessions[e(755)]||(x=this[e(830)])==null||x[e(993)]()}[i(1117)](){var t=i;this[t(560)]=0,this[t(1188)](),this[t(760)]()}[i(1188)](){var t=i;this[t(1186)]!=null&&(clearTimeout(this[t(1186)]),this._retryConnectingTimer=null)}async _createSocket(){var t=i,e;const x=this[t(709)][t(889)](t0),s=(e=x?.collabWebSocketUrl)!=null?e:Rx,r=await this[t(1032)][t(708)](s);return this[t(710)]=r,r}async[i(995)](){var t=i,e,x;try{const s=(x=(e=this[t(830)])!=null?e:this[t(710)])!=null?x:await this[t(715)]();if(s){const r=s[t(851)];s[t(851)]=n=>(this[t(497)](),r[t(505)](s,[n])),s[t(1215)].subscribe(n=>this[t(835)](s,n)),s[t(509)][t(1140)](A0(1)).subscribe(n=>this[t(1038)].error(t(747),n)),s[t(1123)][t(1140)](A0(1))[t(982)](()=>{var n=t;this[n(1111)](s)}),s.close$.pipe(A0(1)).subscribe(n=>{var a=t;this[a(1038)][a(876)](a(912),a(769),n),this[a(848)]()})}}catch(s){this._logService[t(676)](s),this[t(848)]()}}[i(1111)](t){var e=i;this._logService[e(876)](e(912),"socket open."),t[e(851)]({cmd:J.HELLO}),this[e(497)]()}[i(790)](){var t=i;this[t(495)]=!1,this._candidateSocket=null,this[t(891)][t(949)](T0[t(1192)]),this._socket$[t(949)](null),this[t(1015)](),this._clearHeartbeatTimer()}[i(848)](){var t=i,e;this._onOffline(),this._retryCount<((e=this[t(709)].getConfig(Dx))!=null?e:Ux)?(this[t(666)][t(782)]({id:l0[t(1097)]}),this[t(760)]()):this._collaborationUIEventService[t(782)]({id:l0.SOCKET_FAILED})}_tryReconnect(){var t=i,e;const x=this._retryCount,s=this._configService.getConfig(t0),r=x===0?0:((e=s?.retryConnectingInterval)!=null?e:Nx)*2**x;this._retryConnectingTimer=setTimeout(()=>{var n=$;clearTimeout(this[n(1186)]),this[n(1186)]=null,this._tryEnsureSocket()},r),this[t(560)]+=1}[i(835)](t,e){var x=i;const{cmd:s}=e;s===J[x(1021)]&&!this[x(495)]&&(t[x(1105)]=e.data[x(1105)],this[x(593)].next(t),this[x(891)].next(T0[x(1018)]),this[x(495)]=!0,this[x(710)]=null),s===J[x(1004)]&&this[x(1015)](),this._rescheduleHeartbeat()}_rescheduleHeartbeat(){var t=i,e;this[t(1185)](),this[t(1203)]=setTimeout(()=>this._sendHeartbeat(),(e=this[t(709)][t(889)](Ox))!=null?e:wx)}[i(556)](){var t=i;this[t(830)][t(851)]({cmd:J.HEARTBEAT}),this[t(1184)]()}[i(1184)](){var t=i,e;this[t(999)]=setTimeout(()=>this[t(848)](),(e=this[t(709)].getConfig(me))!=null?e:pe)}[i(1185)](){var t=i;this[t(1203)]!=null&&(clearTimeout(this[t(1203)]),this[t(1203)]=null)}[i(1015)](){var t=i;this[t(999)]!=null&&(clearTimeout(this._timeoutTimer),this[t(999)]=null)}};F0=Xx([D0(0,k(X)),D0(1,Q),D0(2,x0),D0(3,Oe),D0(4,k(g0)),D0(5,W(Kx))],F0);var Qx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},z0=(t,e)=>(x,s)=>e(x,s,t);let tt=class extends V0{constructor(t,e,x,s){var r=i,n;super(),L(this,r(934),new Map),L(this,r(896),new h0),L(this,r(1167),this._entityInit$.asObservable()),this[r(819)]=t,this._collabSessionService=e,this[r(709)]=x,this._univerInstanceService=s,((n=this[r(709)].getConfig(t0))==null?void 0:n.enableCollaboration)!==!1&&this[r(673)]()}[i(557)](){var t=i;super[t(557)](),this[t(934)][t(962)](e=>e[t(557)]()),this[t(934)].clear()}[i(987)](t){var e=i,x;return(x=this[e(934)][e(1071)](t))!=null?x:null}[i(1077)](t){var e=i;const x=this[e(987)](t);return x?de(x):this[e(896)][e(1140)](U0(s=>s[e(1114)]===t))}[i(920)](t){var e=i;return ke(this.getCollabEntity$(t)[e(1140)](c0(()=>{})))}_init(){var t=i;this[t(817)][t(894)](s0[t(1171)])[t(1140)](b0(this[t(885)]),zt(16))[t(982)](async e=>{var x=t;const s=e[x(1135)](),r=await this[x(783)](s,r0.UNIVER_SHEET);this._entities[x(839)](s,r)}),this._univerInstanceService[t(894)](s0[t(652)])[t(1140)](b0(this.dispose$),zt(16)).pipe(U0(e=>!e[t(1135)]()[t(1095)]("__")))[t(982)](async e=>{var x=t;const s=e.getUnitId(),r=await this[x(783)](s,r0[x(652)]);this._entities.set(s,r)}),W0(this[t(817)][t(803)](s0[t(1171)]),this._univerInstanceService[t(803)](s0[t(652)])).pipe(b0(this[t(885)]))[t(982)](e=>{var x=t;const s=e[x(1135)](),r=this._entities[x(1071)](s);r&&(r.dispose(),this[x(934)][x(1127)](s))})}async[i(783)](t,e){var x=i;const s=await this._collabSessionService[x(518)](t),r=this[x(819)].createInstance(this[x(1144)](e),t,e,s);return await r.init(),this[x(896)][x(949)](r),r}_getCtorByUniverType(t){var e=i;switch(t){case r0[e(652)]:return vt;case r0[e(1171)]:return _t;default:throw new Error("[CollaborationController]: invalid univer type: "+t)}}};tt=Qx([z0(0,k(X)),z0(1,k(F0)),z0(2,x0),z0(3,S0)],tt);Object[i(838)];var Zx=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},Qt=(t,e)=>(x,s)=>e(x,s,t);const ti="DEFAULT_FILE_NAME",ei=i(496);let bt=class extends L0{constructor(t,e){var x=i;super(),this[x(817)]=t,this._configService=e,this[x(673)]()}[i(673)](){var t=i;this[t(879)](this._univerInstanceService[t(604)].subscribe(()=>{var e=t,x;const s=this._univerInstanceService[e(1064)]();let r=(x=this._configService.getConfig(ti))!=null?x:ei;s instanceof ox&&(r=s.name),document[e(1094)]=r}))}};bt=Zx([Qt(0,S0),Qt(1,x0)],bt);Object[i(838)];var xi=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},ot=(t,e)=>(x,s)=>e(x,s,t);let et=class{constructor(t,e,x){var s=i;this._configService=t,this[s(788)]=e,this[s(1109)]=x,this.init()}[i(958)](){var t=i;this[t(788)][t(875)]({priority:1,interceptor:(e,x)=>x(e)[t(1140)](ax(async s=>{var r=t;const n=s;if(n.status===401){if(typeof window>"u")throw new Error(r(490));if(window[r(504)](this[r(1109)].t(r(743)))){const a=window.encodeURIComponent(window.location[r(687)]);window[r(1190)][r(687)]=this[r(870)]()+r(697)+a}}return n}))})}[i(870)](){var t=i,e;const x=this[t(709)][t(889)](t0);return(e=x?.loginUrlKey)!=null?e:Mx}};et=xi([ot(0,x0),ot(1,k(I0)),ot(2,k(Y0))],et);Object[i(838)];var ii=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},Zt=(t,e)=>(x,s)=>e(x,s,t);const si=i(1020);let mt=class extends L0{constructor(t,e){var x=i;super(),this[x(678)]=t,this[x(709)]=e,this._initMergeInterceptor()}_initMergeInterceptor(){var t=i;const e=this;this[t(879)](this[t(678)][t(875)]({priority:999,interceptor:Le({isMatch(x){var s=t,r;if(x[s(1182)]==="POST"&&(r=x[s(1034)])!=null&&r.body){const{objectID:n,objectType:a}=x[s(1034)][s(751)]||{};if(!n||a===void 0)return!1;const o=e._getAPIPrefixPath()+"/"+a+"/object/"+n+s(1210);if(x.url===o)return!0}return!1},getParamsFromRequest(x){var s=t,r;return(r=x[s(1034)])==null?void 0:r[s(751)]},mergeParamsToRequest(x,s){var r=t;const n=e[r(571)]()+r(545),a=x[r(567)]((c,f)=>{var _=r;const{unitID:l,objectID:h,objectType:v,actions:p}=f;return c[l]||(c[l]={}),c[l][h]||(c[l][h]={objectID:h,objectType:v,actions:[]}),c[l][h][_(538)].push(...p),c},{}),o=[];for(const c in a)for(const f in a[c]){const{actions:_,objectType:l}=a[c][f],h=[...new Set(_)];o.push({unitID:c,objectID:f,objectType:l,actions:h})}return new lx(r(1046),n,{headers:s.headers,withCredentials:s.withCredentials,responseType:s.responseType,body:{requests:o}})}},{distributeResult(x,s){var r=t;const{objectActions:n}=x;return s[r(520)](a=>{var o=r;const{unitID:c,objectID:f,actions:_}=a,l=n[o(774)](v=>v.unitID===c&&v[o(857)]===f),h=_[o(520)](v=>l?.[o(538)][o(774)](p=>p[o(1197)]===v))[o(614)](v=>!!v);return{config:a,result:{actions:h,error:x[o(676)]}}})}})}))}[i(571)](){var t=i,e;const x=this[t(709)][t(889)](t0);return(e=x?.[t(845)])!=null?e:si}async create(t){var e=i;const x=this._getAPIPrefixPath()+"/"+t[e(615)]+"/object";return(await this[e(678)][e(1067)](x,{body:t}))[e(751)].objectID||""}async list(t){var e=i;const x=this._getAPIPrefixPath()+e(955);return(await this[e(678)][e(1067)](x,{body:t}))[e(751)][e(800)]}async update(t){var e=i,x,s;const r=this._getAPIPrefixPath()+"/"+t.objectType+e(972)+t.objectID,n=await this._HTTPService[e(1027)](r,{body:t});if(((s=(x=n?.[e(751)])==null?void 0:x.error)==null?void 0:s[e(860)])!==1)throw new Error("Failed to update permission point")}async allowed(t){var e=i;const x=this[e(571)]()+"/"+t.objectType+e(972)+t[e(857)]+e(1210);return(await this._HTTPService[e(1067)](x,{body:t}))[e(751)][e(538)]}async[i(1231)](t){var e=i;const x=this[e(571)]()+e(545);return(await this._HTTPService[e(1067)](x,{body:{requests:t}}))[e(751)][e(528)]}async[i(577)](t){var e=i;const x=this._getAPIPrefixPath()+"/"+t[e(615)]+"/role",s=await this[e(678)][e(1067)](x,{body:t});return{roles:s[e(751)][e(1045)],actions:s[e(751)][e(538)]}}async[i(1124)](t){var e=i;const x=this[e(571)]()+e(719);await this[e(678)][e(1127)](x,{params:{collaboratorID:t[e(868)],objectID:t.objectID,unitID:t.unitID}})}async[i(978)](t){var e=i;const x=this[e(571)]()+"/collaborator";await this._HTTPService[e(667)](x,{body:t})}async[i(1189)](t){var e=i;const x=this[e(571)]()+e(719);await this[e(678)][e(1067)](x,{body:t})}async[i(1172)](t){var e=i;const x=this._getAPIPrefixPath()+"/collaborator";return(await this._HTTPService[e(1071)](x,{params:{objectID:t[e(857)],unitID:t[e(1114)]}}))[e(751)][e(759)]}async[i(542)](t){var e=i;const x=this[e(571)]()+"/collaborator";await this[e(678)][e(1027)](x,{body:t})}};mt=ii([Zt(0,k(I0)),Zt(1,k(x0))],mt);var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function K0(t){var e=i;return t&&t[e(629)]&&Object.prototype[e(644)][e(837)](t,e(1121))?t[e(1121)]:t}var pt={exports:{}};function ri(t){var e=i;throw new Error(e(734)+t+e(1223))}var Et={exports:{}},ni=Et[i(1090)],te;function o0(){var t=i;return te||(te=1,(function(e,x){(function(s,r){var n=$;e[n(1090)]=r()})(ni,function(){var s=s||(function(r,n){var a=$,o;if(typeof window<"u"&&window.crypto&&(o=window[a(1128)]),typeof self<"u"&&self[a(1128)]&&(o=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(o=globalThis.crypto),!o&&typeof window<"u"&&window[a(794)]&&(o=window[a(794)]),!o&&typeof ct<"u"&&ct.crypto&&(o=ct[a(1128)]),!o&&typeof ri==a(990))try{o=require("crypto")}catch{}var c=function(){var m=a;if(o){if(typeof o[m(672)]=="function")try{return o[m(672)](new Uint32Array(1))[0]}catch{}if(typeof o[m(535)]==m(990))try{return o[m(535)](4)[m(714)]()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},f=Object[a(1211)]||(function(){function m(){}return function(u){var d=$,I;return m[d(1191)]=u,I=new m,m[d(1191)]=null,I}})(),_={},l=_.lib={},h=l[a(886)]=(function(){return{extend:function(m){var u=$,d=f(this);return m&&d.mixIn(m),(!d[u(644)](u(958))||this.init===d[u(958)])&&(d[u(958)]=function(){var I=u;d.$super.init[I(505)](this,arguments)}),d[u(958)].prototype=d,d.$super=this,d},create:function(){var m=$,u=this.extend();return u[m(958)][m(505)](u,arguments),u},init:function(){},mixIn:function(m){var u=$;for(var d in m)m.hasOwnProperty(d)&&(this[d]=m[d]);m[u(644)](u(826))&&(this.toString=m[u(826)])},clone:function(){var m=$;return this.init[m(1191)].extend(this)}}})(),v=l[a(1028)]=h[a(583)]({init:function(m,u){var d=a;m=this[d(1104)]=m||[],u!=n?this[d(791)]=u:this[d(791)]=m[d(936)]*4},toString:function(m){var u=a;return(m||C)[u(1220)](this)},concat:function(m){var u=a,d=this[u(1104)],I=m[u(1104)],U=this[u(791)],M=m[u(791)];if(this.clamp(),U%4)for(var V=0;V<M;V++){var K=I[V>>>2]>>>24-V%4*8&255;d[U+V>>>2]|=K<<24-(U+V)%4*8}else for(var B=0;B<M;B+=4)d[U+B>>>2]=I[B>>>2];return this.sigBytes+=M,this},clamp:function(){var m=a,u=this[m(1104)],d=this[m(791)];u[d>>>2]&=4294967295<<32-d%4*8,u.length=r[m(1099)](d/4)},clone:function(){var m=a,u=h.clone[m(837)](this);return u.words=this.words[m(809)](0),u},random:function(m){for(var u=a,d=[],I=0;I<m;I+=4)d[u(944)](c());return new v[u(958)](d,m)}}),p=_[a(736)]={},C=p.Hex={stringify:function(m){for(var u=a,d=m[u(1104)],I=m[u(791)],U=[],M=0;M<I;M++){var V=d[M>>>2]>>>24-M%4*8&255;U[u(944)]((V>>>4)[u(826)](16)),U[u(944)]((V&15)[u(826)](16))}return U[u(659)]("")},parse:function(m){for(var u=a,d=m[u(936)],I=[],U=0;U<d;U+=2)I[U>>>3]|=parseInt(m[u(665)](U,2),16)<<24-U%8*4;return new v[u(958)](I,d/2)}},D=p[a(1226)]={stringify:function(m){for(var u=a,d=m[u(1104)],I=m[u(791)],U=[],M=0;M<I;M++){var V=d[M>>>2]>>>24-M%4*8&255;U[u(944)](String.fromCharCode(V))}return U[u(659)]("")},parse:function(m){for(var u=a,d=m[u(936)],I=[],U=0;U<d;U++)I[U>>>2]|=(m.charCodeAt(U)&255)<<24-U%4*8;return new v[u(958)](I,d)}},P=p[a(922)]={stringify:function(m){var u=a;try{return decodeURIComponent(escape(D.stringify(m)))}catch{throw new Error(u(574))}},parse:function(m){var u=a;return D[u(918)](unescape(encodeURIComponent(m)))}},T=l[a(1119)]=h[a(583)]({reset:function(){var m=a;this[m(584)]=new v.init,this[m(1219)]=0},_append:function(m){var u=a;typeof m==u(822)&&(m=P[u(918)](m)),this[u(584)][u(1139)](m),this[u(1219)]+=m[u(791)]},_process:function(m){var u=a,d,I=this[u(584)],U=I[u(1104)],M=I[u(791)],V=this.blockSize,K=V*4,B=M/K;m?B=r.ceil(B):B=r[u(1002)]((B|0)-this[u(700)],0);var b=B*V,E=r.min(b*4,M);if(b){for(var g=0;g<b;g+=V)this[u(605)](U,g);d=U.splice(0,b),I[u(791)]-=E}return new v[u(958)](d,E)},clone:function(){var m=a,u=h.clone[m(837)](this);return u._data=this[m(584)][m(703)](),u},_minBufferSize:0});l[a(1173)]=T[a(583)]({cfg:h[a(583)](),init:function(m){var u=a;this.cfg=this[u(1249)].extend(m),this[u(716)]()},reset:function(){var m=a;T[m(716)][m(837)](this),this._doReset()},update:function(m){var u=a;return this[u(1229)](m),this[u(859)](),this},finalize:function(m){var u=a;m&&this[u(1229)](m);var d=this[u(531)]();return d},blockSize:16,_createHelper:function(m){return function(u,d){var I=$;return new m[I(958)](d)[I(1216)](u)}},_createHmacHelper:function(m){return function(u,d){var I=$;return new A.HMAC.init(m,d)[I(1216)](u)}}});var A=_[a(640)]={};return _})(Math);return s})})(Et)),Et[t(1090)]}var It={exports:{}},ai=It[i(1090)],ee;function we(){var t=i;return ee||(ee=1,(function(e,x){(function(s,r){var n=$;e[n(1090)]=r(o0())})(ai,function(s){var r=$;return(function(){var n=$,a=s,o=a.lib,c=o[n(1028)],f=a[n(736)];f[n(1240)]={stringify:function(l){var h=n,v=l.words,p=l[h(791)],C=this._map;l[h(576)]();for(var D=[],P=0;P<p;P+=3)for(var T=v[P>>>2]>>>24-P%4*8&255,A=v[P+1>>>2]>>>24-(P+1)%4*8&255,m=v[P+2>>>2]>>>24-(P+2)%4*8&255,u=T<<16|A<<8|m,d=0;d<4&&P+d*.75<p;d++)D[h(944)](C[h(578)](u>>>6*(3-d)&63));var I=C.charAt(64);if(I)for(;D.length%4;)D[h(944)](I);return D[h(659)]("")},parse:function(l){var h=n,v=l[h(936)],p=this[h(692)],C=this[h(775)];if(!C){C=this[h(775)]=[];for(var D=0;D<p[h(936)];D++)C[p[h(1016)](D)]=D}var P=p[h(578)](64);if(P){var T=l[h(932)](P);T!==-1&&(v=T)}return _(l,v,C)},_map:n(913)};function _(l,h,v){for(var p=n,C=[],D=0,P=0;P<h;P++)if(P%4){var T=v[l[p(1016)](P-1)]<<P%4*2,A=v[l[p(1016)](P)]>>>6-P%4*2,m=T|A;C[D>>>2]|=m<<24-D%4*8,D++}return c[p(1211)](C,D)}})(),s[r(736)].Base64})})(It)),It[t(1090)]}var St={exports:{}},oi=St[i(1090)],xe;function ci(){var t=i;return xe||(xe=1,(function(e,x){(function(s,r){var n=$;e[n(1090)]=r(o0())})(oi,function(s){var r=$;return(function(n){var a=$,o=s,c=o.lib,f=c[a(1028)],_=c[a(1173)],l=o.algo,h=[];(function(){for(var T=a,A=0;A<64;A++)h[A]=n[T(658)](n[T(603)](A+1))*4294967296|0})();var v=l[a(589)]=_.extend({_doReset:function(){var T=a;this[T(749)]=new f[T(958)]([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(T,A){for(var m=a,u=0;u<16;u++){var d=A+u,I=T[d];T[d]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360}var U=this[m(749)][m(1104)],M=T[A+0],V=T[A+1],K=T[A+2],B=T[A+3],b=T[A+4],E=T[A+5],g=T[A+6],y=T[A+7],S=T[A+8],F=T[A+9],G=T[A+10],z=T[A+11],q=T[A+12],Z=T[A+13],v0=T[A+14],_0=T[A+15],R=U[0],O=U[1],w=U[2],N=U[3];R=p(R,O,w,N,M,7,h[0]),N=p(N,R,O,w,V,12,h[1]),w=p(w,N,R,O,K,17,h[2]),O=p(O,w,N,R,B,22,h[3]),R=p(R,O,w,N,b,7,h[4]),N=p(N,R,O,w,E,12,h[5]),w=p(w,N,R,O,g,17,h[6]),O=p(O,w,N,R,y,22,h[7]),R=p(R,O,w,N,S,7,h[8]),N=p(N,R,O,w,F,12,h[9]),w=p(w,N,R,O,G,17,h[10]),O=p(O,w,N,R,z,22,h[11]),R=p(R,O,w,N,q,7,h[12]),N=p(N,R,O,w,Z,12,h[13]),w=p(w,N,R,O,v0,17,h[14]),O=p(O,w,N,R,_0,22,h[15]),R=C(R,O,w,N,V,5,h[16]),N=C(N,R,O,w,g,9,h[17]),w=C(w,N,R,O,z,14,h[18]),O=C(O,w,N,R,M,20,h[19]),R=C(R,O,w,N,E,5,h[20]),N=C(N,R,O,w,G,9,h[21]),w=C(w,N,R,O,_0,14,h[22]),O=C(O,w,N,R,b,20,h[23]),R=C(R,O,w,N,F,5,h[24]),N=C(N,R,O,w,v0,9,h[25]),w=C(w,N,R,O,B,14,h[26]),O=C(O,w,N,R,S,20,h[27]),R=C(R,O,w,N,Z,5,h[28]),N=C(N,R,O,w,K,9,h[29]),w=C(w,N,R,O,y,14,h[30]),O=C(O,w,N,R,q,20,h[31]),R=D(R,O,w,N,E,4,h[32]),N=D(N,R,O,w,S,11,h[33]),w=D(w,N,R,O,z,16,h[34]),O=D(O,w,N,R,v0,23,h[35]),R=D(R,O,w,N,V,4,h[36]),N=D(N,R,O,w,b,11,h[37]),w=D(w,N,R,O,y,16,h[38]),O=D(O,w,N,R,G,23,h[39]),R=D(R,O,w,N,Z,4,h[40]),N=D(N,R,O,w,M,11,h[41]),w=D(w,N,R,O,B,16,h[42]),O=D(O,w,N,R,g,23,h[43]),R=D(R,O,w,N,F,4,h[44]),N=D(N,R,O,w,q,11,h[45]),w=D(w,N,R,O,_0,16,h[46]),O=D(O,w,N,R,K,23,h[47]),R=P(R,O,w,N,M,6,h[48]),N=P(N,R,O,w,y,10,h[49]),w=P(w,N,R,O,v0,15,h[50]),O=P(O,w,N,R,E,21,h[51]),R=P(R,O,w,N,q,6,h[52]),N=P(N,R,O,w,B,10,h[53]),w=P(w,N,R,O,G,15,h[54]),O=P(O,w,N,R,V,21,h[55]),R=P(R,O,w,N,S,6,h[56]),N=P(N,R,O,w,_0,10,h[57]),w=P(w,N,R,O,g,15,h[58]),O=P(O,w,N,R,Z,21,h[59]),R=P(R,O,w,N,b,6,h[60]),N=P(N,R,O,w,z,10,h[61]),w=P(w,N,R,O,K,15,h[62]),O=P(O,w,N,R,F,21,h[63]),U[0]=U[0]+R|0,U[1]=U[1]+O|0,U[2]=U[2]+w|0,U[3]=U[3]+N|0},_doFinalize:function(){var T=a,A=this[T(584)],m=A[T(1104)],u=this[T(1219)]*8,d=A.sigBytes*8;m[d>>>5]|=128<<24-d%32;var I=n.floor(u/4294967296),U=u;m[(d+64>>>9<<4)+15]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,m[(d+64>>>9<<4)+14]=(U<<8|U>>>24)&16711935|(U<<24|U>>>8)&4278255360,A[T(791)]=(m[T(936)]+1)*4,this[T(859)]();for(var M=this[T(749)],V=M[T(1104)],K=0;K<4;K++){var B=V[K];V[K]=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360}return M},clone:function(){var T=a,A=_[T(703)][T(837)](this);return A._hash=this._hash[T(703)](),A}});function p(T,A,m,u,d,I,U){var M=T+(A&m|~A&u)+d+U;return(M<<I|M>>>32-I)+A}function C(T,A,m,u,d,I,U){var M=T+(A&u|m&~u)+d+U;return(M<<I|M>>>32-I)+A}function D(T,A,m,u,d,I,U){var M=T+(A^m^u)+d+U;return(M<<I|M>>>32-I)+A}function P(T,A,m,u,d,I,U){var M=T+(m^(A|~u))+d+U;return(M<<I|M>>>32-I)+A}o[a(589)]=_[a(691)](v),o[a(849)]=_[a(792)](v)})(Math),s[r(589)]})})(St)),St[t(1090)]}var gt={exports:{}},Ct={exports:{}},hi=Ct[i(1090)],ie;function ui(){var t=i;return ie||(ie=1,(function(e,x){(function(s,r){var n=$;e[n(1090)]=r(o0())})(hi,function(s){var r=$;return(function(){var n=$,a=s,o=a.lib,c=o.WordArray,f=o[n(1173)],_=a[n(640)],l=[],h=_[n(534)]=f.extend({_doReset:function(){var v=n;this[v(749)]=new c[v(958)]([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(v,p){for(var C=n,D=this[C(749)][C(1104)],P=D[0],T=D[1],A=D[2],m=D[3],u=D[4],d=0;d<80;d++){if(d<16)l[d]=v[p+d]|0;else{var I=l[d-3]^l[d-8]^l[d-14]^l[d-16];l[d]=I<<1|I>>>31}var U=(P<<5|P>>>27)+u+l[d];d<20?U+=(T&A|~T&m)+1518500249:d<40?U+=(T^A^m)+1859775393:d<60?U+=(T&A|T&m|A&m)-1894007588:U+=(T^A^m)-899497514,u=m,m=A,A=T<<30|T>>>2,T=P,P=U}D[0]=D[0]+P|0,D[1]=D[1]+T|0,D[2]=D[2]+A|0,D[3]=D[3]+m|0,D[4]=D[4]+u|0},_doFinalize:function(){var v=n,p=this[v(584)],C=p[v(1104)],D=this[v(1219)]*8,P=p[v(791)]*8;return C[P>>>5]|=128<<24-P%32,C[(P+64>>>9<<4)+14]=Math[v(507)](D/4294967296),C[(P+64>>>9<<4)+15]=D,p[v(791)]=C[v(936)]*4,this._process(),this[v(749)]},clone:function(){var v=n,p=f.clone[v(837)](this);return p[v(749)]=this[v(749)][v(703)](),p}});a[n(534)]=f[n(691)](h),a[n(633)]=f._createHmacHelper(h)})(),s[r(534)]})})(Ct)),Ct[t(1090)]}var Tt={exports:{}},li=Tt[i(1090)],se;function fi(){return se||(se=1,(function(t,e){(function(x,s){t.exports=s(o0())})(li,function(x){(function(){var s=$,r=x,n=r.lib,a=n[s(886)],o=r[s(736)],c=o[s(922)],f=r[s(640)];f[s(549)]=a.extend({init:function(_,l){var h=s;_=this[h(1157)]=new _.init,typeof l=="string"&&(l=c[h(918)](l));var v=_[h(499)],p=v*4;l[h(791)]>p&&(l=_[h(1216)](l)),l[h(576)]();for(var C=this[h(983)]=l.clone(),D=this[h(1075)]=l[h(703)](),P=C.words,T=D[h(1104)],A=0;A<v;A++)P[A]^=1549556828,T[A]^=909522486;C.sigBytes=D.sigBytes=p,this[h(716)]()},reset:function(){var _=s,l=this._hasher;l.reset(),l[_(526)](this[_(1075)])},update:function(_){var l=s;return this[l(1157)].update(_),this},finalize:function(_){var l=s,h=this._hasher,v=h[l(1216)](_);h[l(716)]();var p=h[l(1216)](this[l(983)][l(703)]()[l(1139)](v));return p}})})()})})(Tt)),Tt.exports}var di=gt[i(1090)],re;function Ne(){var t=i;return re||(re=1,(function(e,x){(function(s,r,n){var a=$;e[a(1090)]=r(o0(),ui(),fi())})(di,function(s){var r=$;return(function(){var n=$,a=s,o=a[n(793)],c=o[n(886)],f=o[n(1028)],_=a[n(640)],l=_[n(589)],h=_[n(773)]=c.extend({cfg:c[n(583)]({keySize:128/32,hasher:l,iterations:1}),init:function(v){var p=n;this[p(1249)]=this[p(1249)][p(583)](v)},compute:function(v,p){for(var C=n,D,P=this[C(1249)],T=P[C(961)][C(1211)](),A=f.create(),m=A[C(1104)],u=P[C(1073)],d=P[C(1060)];m[C(936)]<u;){D&&T[C(526)](D),D=T[C(526)](v).finalize(p),T[C(716)]();for(var I=1;I<d;I++)D=T[C(1216)](D),T.reset();A[C(1139)](D)}return A[C(791)]=u*4,A}});a[n(773)]=function(v,p,C){var D=n;return h[D(1211)](C)[D(964)](v,p)}})(),s[r(773)]})})(gt)),gt[t(1090)]}var yt={exports:{}},vi=yt[i(1090)],ne;function De(){var t=i;return ne||(ne=1,(function(e,x){(function(s,r,n){e.exports=r(o0(),Ne())})(vi,function(s){var r=$;s[r(793)][r(1126)]||(function(n){var a=r,o=s,c=o[a(793)],f=c.Base,_=c[a(1028)],l=c[a(1119)],h=o[a(736)];h[a(922)];var v=h[a(1240)],p=o[a(640)],C=p[a(773)],D=c[a(1126)]=l[a(583)]({cfg:f[a(583)](),createEncryptor:function(b,E){var g=a;return this[g(1211)](this[g(488)],b,E)},createDecryptor:function(b,E){var g=a;return this[g(1211)](this._DEC_XFORM_MODE,b,E)},init:function(b,E,g){var y=a;this[y(1249)]=this[y(1249)][y(583)](g),this._xformMode=b,this[y(1083)]=E,this[y(716)]()},reset:function(){var b=a;l[b(716)][b(837)](this),this._doReset()},process:function(b){var E=a;return this[E(1229)](b),this[E(859)]()},finalize:function(b){var E=a;b&&this[E(1229)](b);var g=this[E(531)]();return g},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function b(E){var g=$;return typeof E==g(822)?B:M}return function(E){return{encrypt:function(g,y,S){return b(y).encrypt(E,g,y,S)},decrypt:function(g,y,S){return b(y).decrypt(E,g,y,S)}}}})()});c.StreamCipher=D[a(583)]({_doFinalize:function(){var b=a,E=this[b(859)](!0);return E},blockSize:1});var P=o.mode={},T=c[a(612)]=f[a(583)]({createEncryptor:function(b,E){var g=a;return this.Encryptor[g(1211)](b,E)},createDecryptor:function(b,E){var g=a;return this[g(1082)][g(1211)](b,E)},init:function(b,E){var g=a;this[g(1198)]=b,this._iv=E}}),A=P[a(611)]=(function(){var b=a,E=T[b(583)]();E[b(671)]=E.extend({processBlock:function(y,S){var F=b,G=this._cipher,z=G.blockSize;g[F(837)](this,y,S,z),G[F(491)](y,S),this[F(554)]=y[F(809)](S,S+z)}}),E[b(1082)]=E.extend({processBlock:function(y,S){var F=b,G=this._cipher,z=G[F(499)],q=y[F(809)](S,S+z);G.decryptBlock(y,S),g[F(837)](this,y,S,z),this[F(554)]=q}});function g(y,S,F){var G=b,z,q=this._iv;q?(z=q,this._iv=n):z=this[G(554)];for(var Z=0;Z<F;Z++)y[S+Z]^=z[Z]}return E})(),m=o.pad={},u=m[a(558)]={pad:function(b,E){for(var g=a,y=E*4,S=y-b.sigBytes%y,F=S<<24|S<<16|S<<8|S,G=[],z=0;z<S;z+=4)G[g(944)](F);var q=_[g(1211)](G,S);b.concat(q)},unpad:function(b){var E=a,g=b.words[b[E(791)]-1>>>2]&255;b[E(791)]-=g}};c[a(1199)]=D.extend({cfg:D.cfg.extend({mode:A,padding:u}),reset:function(){var b=a,E;D[b(716)][b(837)](this);var g=this[b(1249)],y=g.iv,S=g[b(690)];this[b(953)]==this[b(488)]?E=S[b(754)]:(E=S.createDecryptor,this._minBufferSize=1),this._mode&&this[b(1236)][b(563)]==E?this[b(1236)][b(958)](this,y&&y.words):(this[b(1236)]=E[b(837)](S,this,y&&y[b(1104)]),this[b(1236)][b(563)]=E)},_doProcessBlock:function(b,E){var g=a;this._mode[g(1206)](b,E)},_doFinalize:function(){var b=a,E,g=this.cfg[b(957)];return this[b(953)]==this[b(488)]?(g.pad(this[b(584)],this[b(499)]),E=this[b(859)](!0)):(E=this[b(859)](!0),g[b(648)](E)),E},blockSize:128/32});var d=c[a(948)]=f[a(583)]({init:function(b){this.mixIn(b)},toString:function(b){var E=a;return(b||this.formatter)[E(1220)](this)}}),I=o[a(968)]={},U=I[a(1146)]={stringify:function(b){var E=a,g,y=b[E(834)],S=b[E(517)];return S?g=_[E(1211)]([1398893684,1701076831])[E(1139)](S)[E(1139)](y):g=y,g[E(826)](v)},parse:function(b){var E=a,g,y=v[E(918)](b),S=y[E(1104)];return S[0]==1398893684&&S[1]==1701076831&&(g=_[E(1211)](S[E(809)](2,4)),S.splice(0,4),y[E(791)]-=16),d[E(1211)]({ciphertext:y,salt:g})}},M=c[a(512)]=f[a(583)]({cfg:f[a(583)]({format:U}),encrypt:function(b,E,g,y){var S=a;y=this[S(1249)][S(583)](y);var F=b[S(754)](g,y),G=F[S(1216)](E),z=F[S(1249)];return d[S(1211)]({ciphertext:G,key:g,iv:z.iv,algorithm:b,mode:z[S(690)],padding:z.padding,blockSize:b.blockSize,formatter:y[S(968)]})},decrypt:function(b,E,g,y){var S=a;y=this.cfg[S(583)](y),E=this[S(592)](E,y[S(968)]);var F=b[S(785)](g,y).finalize(E[S(834)]);return F},_parse:function(b,E){var g=a;return typeof b==g(822)?E[g(918)](b,this):b}}),V=o.kdf={},K=V[a(1146)]={execute:function(b,E,g,y,S){var F=a;if(y||(y=_.random(64/8)),S)var G=C[F(1211)]({keySize:E+g,hasher:S})[F(964)](b,y);else var G=C[F(1211)]({keySize:E+g}).compute(b,y);var z=_[F(1211)](G[F(1104)].slice(E),g*4);return G[F(791)]=E*4,d[F(1211)]({key:G,iv:z,salt:y})}},B=c.PasswordBasedCipher=M[a(583)]({cfg:M[a(1249)][a(583)]({kdf:K}),encrypt:function(b,E,g,y){var S=a;y=this.cfg.extend(y);var F=y[S(1207)][S(1072)](g,b[S(1073)],b[S(883)],y[S(517)],y[S(961)]);y.iv=F.iv;var G=M[S(1214)][S(837)](this,b,E,F.key,y);return G[S(656)](F),G},decrypt:function(b,E,g,y){var S=a;y=this[S(1249)][S(583)](y),E=this[S(592)](E,y[S(968)]);var F=y[S(1207)][S(1072)](g,b[S(1073)],b[S(883)],E[S(517)],y[S(961)]);y.iv=F.iv;var G=M.decrypt[S(837)](this,b,E,F[S(777)],y);return G}})})()})})(yt)),yt[t(1090)]}var _i=pt.exports,ae;function bi(){return ae||(ae=1,(function(t,e){(function(x,s,r){var n=$;t[n(1090)]=s(o0(),we(),ci(),Ne(),De())})(_i,function(x){var s=$;return(function(){var r=$,n=x,a=n[r(793)],o=a[r(1199)],c=n.algo,f=[],_=[],l=[],h=[],v=[],p=[],C=[],D=[],P=[],T=[];(function(){for(var u=[],d=0;d<256;d++)d<128?u[d]=d<<1:u[d]=d<<1^283;for(var I=0,U=0,d=0;d<256;d++){var M=U^U<<1^U<<2^U<<3^U<<4;M=M>>>8^M&255^99,f[I]=M,_[M]=I;var V=u[I],K=u[V],B=u[K],b=u[M]*257^M*16843008;l[I]=b<<24|b>>>8,h[I]=b<<16|b>>>16,v[I]=b<<8|b>>>24,p[I]=b;var b=B*16843009^K*65537^V*257^I*16843008;C[M]=b<<24|b>>>8,D[M]=b<<16|b>>>16,P[M]=b<<8|b>>>24,T[M]=b,I?(I=V^u[u[u[B^V]]],U^=u[u[U]]):I=U=1}})();var A=[0,1,2,4,8,16,32,64,128,27,54],m=c[r(872)]=o[r(583)]({_doReset:function(){var u=r,d;if(!(this[u(858)]&&this[u(702)]===this._key)){for(var I=this[u(702)]=this[u(1083)],U=I[u(1104)],M=I[u(791)]/4,V=this[u(858)]=M+6,K=(V+1)*4,B=this[u(587)]=[],b=0;b<K;b++)b<M?B[b]=U[b]:(d=B[b-1],b%M?M>6&&b%M==4&&(d=f[d>>>24]<<24|f[d>>>16&255]<<16|f[d>>>8&255]<<8|f[d&255]):(d=d<<8|d>>>24,d=f[d>>>24]<<24|f[d>>>16&255]<<16|f[d>>>8&255]<<8|f[d&255],d^=A[b/M|0]<<24),B[b]=B[b-M]^d);for(var E=this._invKeySchedule=[],g=0;g<K;g++){var b=K-g;if(g%4)var d=B[b];else var d=B[b-4];g<4||b<=4?E[g]=d:E[g]=C[f[d>>>24]]^D[f[d>>>16&255]]^P[f[d>>>8&255]]^T[f[d&255]]}}},encryptBlock:function(u,d){var I=r;this[I(1129)](u,d,this[I(587)],l,h,v,p,f)},decryptBlock:function(u,d){var I=r,U=u[d+1];u[d+1]=u[d+3],u[d+3]=U,this[I(1129)](u,d,this[I(1132)],C,D,P,T,_);var U=u[d+1];u[d+1]=u[d+3],u[d+3]=U},_doCryptBlock:function(u,d,I,U,M,V,K,B){for(var b=r,E=this[b(858)],g=u[d]^I[0],y=u[d+1]^I[1],S=u[d+2]^I[2],F=u[d+3]^I[3],G=4,z=1;z<E;z++){var q=U[g>>>24]^M[y>>>16&255]^V[S>>>8&255]^K[F&255]^I[G++],Z=U[y>>>24]^M[S>>>16&255]^V[F>>>8&255]^K[g&255]^I[G++],v0=U[S>>>24]^M[F>>>16&255]^V[g>>>8&255]^K[y&255]^I[G++],_0=U[F>>>24]^M[g>>>16&255]^V[y>>>8&255]^K[S&255]^I[G++];g=q,y=Z,S=v0,F=_0}var q=(B[g>>>24]<<24|B[y>>>16&255]<<16|B[S>>>8&255]<<8|B[F&255])^I[G++],Z=(B[y>>>24]<<24|B[S>>>16&255]<<16|B[F>>>8&255]<<8|B[g&255])^I[G++],v0=(B[S>>>24]<<24|B[F>>>16&255]<<16|B[g>>>8&255]<<8|B[y&255])^I[G++],_0=(B[F>>>24]<<24|B[g>>>16&255]<<16|B[y>>>8&255]<<8|B[S&255])^I[G++];u[d]=q,u[d+1]=Z,u[d+2]=v0,u[d+3]=_0},keySize:256/32});n[r(872)]=o[r(691)](m)})(),x[s(872)]})})(pt)),pt.exports}var mi=bi();const pi=K0(mi);var Ei=we();const oe=K0(Ei);var Rt={exports:{}},Ii=Rt[i(1090)],ce;function Si(){var t=i;return ce||(ce=1,(function(e,x){(function(s,r){e.exports=r(o0())})(Ii,function(s){var r=$;return s[r(736)][r(922)]})})(Rt)),Rt[t(1090)]}var gi=Si();const Ci=K0(gi);var Ot={exports:{}},Ti=Ot.exports,he;function yi(){var t=i;return he||(he=1,(function(e,x){(function(s,r){e.exports=r(o0())})(Ti,function(s){var r=$;return(function(){var n=$;if(typeof ArrayBuffer=="function"){var a=s,o=a[n(793)],c=o[n(1028)],f=c.init,_=c.init=function(l){var h=n;if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l[h(821)],l[h(772)],l.byteLength)),l instanceof Uint8Array){for(var v=l[h(1011)],p=[],C=0;C<v;C++)p[C>>>2]|=l[C]<<24-C%4*8;f[h(837)](this,p,v)}else f[h(505)](this,arguments)};_[n(1191)]=c}})(),s[r(793)][r(1028)]})})(Ot)),Ot[t(1090)]}var Ri=yi();const Oi=K0(Ri);var wt={exports:{}},wi=wt[i(1090)],ue;function Ni(){var t=i;return ue||(ue=1,(function(e,x){(function(s,r,n){var a=$;e[a(1090)]=r(o0(),De())})(wi,function(s){var r=$;return s[r(805)][r(842)]={pad:function(){},unpad:function(){}},s[r(805)].NoPadding})})(wt)),wt[t(1090)]}var Di=Ni();const Ui=K0(Di);function Ai(t,e){var x=i;const s=e-t[x(936)]%e,r=String[x(916)](s)[x(1162)](s);return t+r}function Mi(t,e){var x=i;const s=Oi[x(508)](16),r=Ai(t,16),n=pi[x(1214)](Ci[x(918)](r),oe[x(918)](e),{iv:s,padding:Ui});return s[x(1139)](n[x(834)])[x(826)](oe)}function Pi(){var t=i;const e=ux().__Key__;if(e){const x={time:Math[t(507)](Date[t(529)]()/1e3),domain:location.hostname};return Mi(JSON.stringify(x),e)}}Object[i(838)];var Li=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},ki=(t,e)=>(x,s)=>e(x,s,t);let xt=class{constructor(t){var e=i;this._httpService=t,this[e(1193)]()}[i(1193)](){var t=i;this._httpService[t(875)]({interceptor:(e,x)=>{var s=t;const r=e[s(811)],n=Pi();return n&&r[s(839)](s(1152),n),x(e)}})}};xt=Li([ki(0,k(I0))],xt);Object[i(838)];var Hi=(t,e,x,s)=>{for(var r=e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(r=a(r)||r);return r},ht=(t,e)=>(x,s)=>e(x,s,t);let Nt=class extends V0{constructor(t,e,x){var s=i;super(),L(this,s(547),new M0(null)),L(this,"unitInfo$",this[s(547)][s(738)]()),this[s(1038)]=t,this._snapshotService=e,this._localCacheService=x}async[i(802)](t,e,x){var s=i;this._unitInfo$[s(949)]({unitId:t,type:e});let r=null;switch(e){case r0.UNIVER_SHEET:{r=await this._snapshotService[s(1008)](t,x);break}case r0[s(652)]:{r=await this[s(1022)][s(726)](t,x);break}default:{this[s(1038)][s(676)](s(776),s(816));break}}return r}async loadUnit(t,e,x){var s=i,r;this[s(547)][s(949)]({unitId:t,type:e,subUnitId:x});let n=0;const a=await((r=this[s(1025)])==null?void 0:r[s(780)](t));return a&&(a[s(1030)]||a[s(501)][s(936)]!==0)&&(n=a[s(827)]),n===0&&this._logService[s(876)](s(776),s(933)),this[s(802)](t,e,n)}};Nt=Hi([ht(0,Q),ht(1,k(mx)),ht(2,W(i0))],Nt);Object[i(838)];var ji=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},ut=(t,e)=>(x,s)=>e(x,s,t);const Bi=["image/png",i(1248),i(521),"image/gif",i(536)],Fi=5*1024*1024,$i=i(963),Vi="/universer-api/file/{fileID}/sign-url";let Dt=class{constructor(t,e,x){var s=i;L(this,"_waitCount",0),L(this,s(502),new h0),L(this,s(986),this._change$),L(this,s(1063),new Map),this[s(788)]=t,this[s(709)]=e,this[s(817)]=x}setWaitCount(t){var e=i;this[e(685)]=t,this[e(502)].next(t)}getImageSourceCache(t,e){var x=i;if(e===nt[x(741)]){const s=new Image;return s[x(945)]=t,s}return this[x(1063)][x(1071)](t)}[i(942)](t,e,x){var s=i;e===nt[s(741)]||x==null||this[s(1063)][s(839)](t,x)}async getImage(t){var e=i;try{const x=this[e(833)](this[e(943)](),""+t),s=(await this[e(788)][e(1071)](x))[e(751)];if(s[e(676)]&&s.error[e(860)]===Ee.OK){const r=new URL(s[e(946)],this[e(1076)]())[e(826)]();return Promise.resolve(r)}return Promise[e(728)](s[e(676)])}catch(x){return Promise[e(728)](x)}}async[i(498)](t){var e=i;let x="";if(!Bi[e(654)](t[e(670)]))return this[e(1118)](),Promise.reject(new Error(w0[e(1035)]));if(t[e(755)]>Fi)return this[e(1118)](),Promise[e(728)](new Error(w0.ERROR_EXCEED_SIZE));try{const s=new FormData;s.append(e(650),t);const r=this[e(817)][e(1064)](),n=r?.[e(1135)]();if(!n)throw new Error(e(675));const a=this[e(646)]()+e(841)+t[e(755)].toString()+e(553)+Ie[e(596)]+"&assign="+encodeURIComponent(n),o={body:s},c=(await this[e(788)][e(1067)](a,o))[e(751)];if(typeof c[e(679)]!=e(822))return this[e(1118)](),Promise.reject(new Error(w0.ERROR_IMAGE));x=c[e(679)]}catch{return this[e(1118)](),Promise[e(728)](new Error(w0[e(757)]))}return new Promise((s,r)=>{var n=e;const a=new FileReader;a[n(568)](t),a[n(643)]=o=>{var c=n,f;const _=(f=o[c(699)])==null?void 0:f.result;if(_==null){this[c(1118)](),r(new Error(w0[c(757)]));return}const l=Be(6);s({imageId:l,imageSourceType:nt[c(973)],source:x,base64Cache:_,status:w0[c(1024)]}),this[c(1118)]()}})}[i(646)](){var t=i,e;const x=this._configService[t(889)](t0);return(e=x?.[t(540)])!=null?e:$i}[i(943)](){var t=i,e;const x=this[t(709)].getConfig(t0);return(e=x?.[t(621)])!=null?e:Vi}[i(1076)](){var t=i,e;const x=this[t(709)][t(889)](t0);return(e=x?.downloadEndpointUrl)!=null?e:location.origin}[i(833)](t,e){var x=i;return t[x(503)](x(725),e)}[i(1118)](){var t=i;this[t(685)]-=1,this[t(502)][t(949)](this._waitCount)}};Dt=ji([ut(0,k(I0)),ut(1,x0),ut(2,k(S0))],Dt);Object[i(838)];var Gi=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},le=(t,e)=>(x,s)=>e(x,s,t);const Yi=i(1020);let Ut=class{constructor(t,e){var x=i;this[x(709)]=t,this._HTTPService=e}_getAPIPrefixPath(){var t=i,e;const x=this[t(709)][t(889)](t0);return(e=x?.[t(845)])!=null?e:Yi}async[i(1202)](t){var e=i;const x=this[e(571)]()+e(719);return{list:[{title:"People",mentions:(await this[e(678)][e(1071)](x,{params:{objectID:t.unitId,unitID:t.unitId}}))[e(751)].collaborators[e(520)](s=>({objectId:s.id,name:s[e(548)][e(693)],metadata:{icon:s[e(548)].avatar},label:s[e(548)][e(693)],objectType:Ft[e(1059)]})),metadata:{},type:Ft[e(1059)]}]}}};Ut=Gi([le(0,k(x0)),le(1,k(I0))],Ut);Object[i(838)];var Ki=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},H0=(t,e)=>(x,s)=>e(x,s,t);let it=class extends V0{constructor(t,e,x,s,r){var n=i;super(),this._injector=t,this[n(817)]=e,this[n(515)]=x,this._collaborationSessionService=s,this[n(666)]=r,this[n(1156)](),this[n(831)]()}[i(831)](){var t=i;const e=async x=>{var s=$;(await this[s(977)][s(518)](x))[s(1160)][s(1140)](U0(r=>r[s(903)]===H[s(1050)]),b0(this[s(885)]))[s(982)](r=>{var n=s;const a=r,{reason:o}=a[n(1080)];this._collaborationUIEventService[n(782)]({id:l0.CLOSE_ROOM,data:o}),this[n(515)][n(1106)](new q0(x).id,!1),this._collaborationSessionService[n(1006)](x)})};W0(this._univerInstanceService[t(894)](s0[t(1171)]),this[t(817)].getTypeOfUnitAdded$(s0[t(652)]))[t(1140)](c0(x=>x[t(1135)]()),U0(x=>!Kt(x)),b0(this[t(885)]))[t(982)](x=>{e(x)})}_initUnitPermissionChange(){var t=i;const e=async x=>{var s=$;const r=await this._collaborationSessionService[s(518)](x),n=this[s(819)][s(1071)](hx);r.event$[s(1140)](U0(a=>a[s(903)]===H[s(928)]),b0(this[s(885)])).subscribe(a=>{var o=s;const c=a,{objectId:f}=c.data;f===x?n[o(808)](x):n[o(806)](x,f)})};W0(this[t(817)][t(894)](s0[t(1171)]))[t(1140)](c0(x=>x[t(1135)]()),U0(x=>!Kt(x)),b0(this[t(885)]))[t(982)](x=>{e(x)})}};it=Ki([H0(0,k(X)),H0(1,S0),H0(2,G0),H0(3,k(F0)),H0(4,k(g0))],it);var zi=(t,e,x,s)=>{for(var r=e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(r=a(r)||r);return r},fe=(t,e)=>(x,s)=>e(x,s,t);let At=class{constructor(t,e){var x=i;this[x(709)]=t,this[x(788)]=e}async[i(926)](t,e){var x=i,s;const{unitID:r,type:n,revision:a=0}=e,o=this.getSnapshotAPIPath()+"/"+n+"/unit/"+r+x(516)+a,c=(await this[x(788)][x(1071)](o))[x(751)],f=(s=c[x(610)])==null?void 0:s.workbook;if(f){const _=f?.[x(824)],l=Vt[x(1234)](Gt(_));f.originalMeta=l,Object[x(861)](f[x(1085)])[x(962)](([,h])=>{var v=x;const p=h[v(824)],C=Vt.encode(Gt(p));h[v(824)]=C})}return c}async[i(905)](t,e){var x=i;const{unitID:s,type:r,blockID:n}=e,a=this._getAPIPrefix()+"/"+r+x(1010)+s+x(1091)+n;return(await this._httpService[x(1071)](a)).body}async getDeserializedSheetBlock(t,e){var x=i;const{unitID:s,type:r,blockID:n}=e,a=this[x(1042)]()+x(1091)+r+"/unit/"+s+x(1091)+n;return(await this._httpService[x(1071)](a))[x(751)]}async[i(713)](t,e){var x=i;const{unitID:s,type:r,from:n,to:a}=e,o=this._getAPIPrefix()+"/"+r+"/unit/"+s+x(929)+n+"&to="+a;return(await this._httpService[x(1071)](o)).body}[i(591)](){var t=i,e;return(e=this[t(709)].getConfig(Tx))!=null?e:this[t(1042)]()}[i(1042)](){var t=i,e;const x=this._configService.getConfig(t0);return(e=x?.[t(669)])!=null?e:Cx}async[i(864)](t,e){var x=i;const s="/universer-api/snapshot/"+e[x(670)]+x(1010)+e[x(1114)]+x(815);return(await this._httpService[x(1071)](s,{params:{resourceId:JSON[x(1220)](e[x(523)])}}))[x(751)]}[i(992)](){var t=i;throw new Error(t(489))}[i(758)](){var t=i;throw new Error(t(489))}[i(969)](){var t=i;throw new Error(t(489))}[i(767)](){var t=i;throw new Error(t(489))}[i(730)](){var t=i;throw new Error(t(489))}getLatestCsReqIdBySid(){var t=i;throw new Error(t(489))}};At=zi([fe(0,x0),fe(1,k(I0))],At);Object[i(838)];var Ji=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},j0=(t,e)=>(x,s)=>e(x,s,t);let Mt=class extends Ge{constructor(t,e,x,s,r){var n=i;super(t,e,x),this._transformService=s,this[n(1038)]=r}[i(525)](t,e){var x=i;const s=this._getUndoStack(t);if(s)try{const n=this[x(865)](s,e);this[x(595)](t,n)}catch(n){this[x(1038)].error(x(1168),n),this[x(1093)](t)}const r=this[x(717)](t);if(r)try{const n=this._transformStack(r,e);this._substituteRedoStack(t,n)}catch(n){this[x(1038)].error(n),this._clearRedo(t)}}[i(1093)](t){var e=i;const x=this[e(1040)](t);x&&(x.length=0,this[e(937)]())}[i(1013)](t){var e=i;const x=this[e(717)](t);x&&(x.length=0,this[e(937)]())}[i(595)](t,e){var x=i;this[x(686)][x(839)](t,e),this[x(937)]()}[i(907)](t,e){var x=i;this[x(795)][x(839)](t,e),this._updateStatus()}[i(865)](t,e){var x=i;const s=[];let r=e,n=e;for(let a=t[x(936)]-1;a>=0;a--){const{unitID:o,undoMutations:c,redoMutations:f}=t[a],_=this[x(718)][x(877)](r,c),l=this[x(718)][x(877)](n,f);if(Bt(_)||Bt(l)){this[x(1038)][x(676)](x(1168),x(844),_,l);break}r=_[x(1145)],n=l.c1Prime,s[x(944)]({unitID:o,undoMutations:_[x(852)],redoMutations:l[x(852)]})}return s[x(1029)]()}};Mt=Ji([j0(0,S0),j0(1,e0),j0(2,px),j0(3,y0),j0(4,Q)],Mt);var Wi=Object.defineProperty;Object[i(838)];var qi=(t,e,x)=>e in t?Wi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:x}):t[e]=x,Xi=(t,e,x,s)=>{for(var r=i,n=e,a=t[r(936)]-1,o;a>=0;a--)(o=t[a])&&(n=o(n)||n);return n},lt=(t,e)=>(x,s)=>e(x,s,t),Qi=(t,e,x)=>qi(t,e+"",x);const Zi="UNIVER_COLLABORATION_CLIENT_PLUGIN";let ft=class extends We{constructor(t,e,x,s){var r=i;super(),L(this,"_config"),this[r(1038)]=e,this._injector=x,this._configService=s;const{...n}=qe({},$x,t);if(!n.socketService)throw new Error(r(575));this[r(1130)]=n,this._configService[r(1014)](t0,n)}[i(609)](){var t=i;this[t(770)](),this[t(784)]()}[i(770)](){var t=i,e,x;this._injector.has(u0)&&this[t(1038)][t(676)]("[UniverCollaborationClientPlugin]",t(630));const s=Xe([[u0,{useClass:Mt}],[F0],[B0],[X0],[et],[xt],[Se],[it],[g0],[Nt],[Oe,{useClass:this[t(1130)].socketService}],[_e,{useClass:At}],[Qe,{useClass:mt}],[Ze,{useClass:Dt}],[tx,{useClass:Ut}],[tt],[bt]],(e=this[t(1130)])==null?void 0:e.override);if(!((x=this[t(1130)])!=null&&x[t(1113)])){const r=s[t(902)](([n])=>n===rt);r!==-1&&s[t(632)](r,1)}ex(this._injector,s)}[i(784)](){var t=i,e,x,s;this._injector[t(1071)](I0).registerHTTPInterceptor({priority:20,interceptor:xx({maxParallel:6})}),(e=this._config)!=null&&e[t(613)]||(x=this[t(819)][t(1071)](i0,ix.OPTIONAL))==null||x.disableLocalCache(),(s=this[t(1130)])!=null&&s[t(1051)]&&Yt(this[t(819)],[[et]]),Yt(this[t(819)],[[xt],[tt],[it]])}};Qi(ft,i(748),Zi),ft=Xi([fx(vx,dx),lt(1,Q),lt(2,k(X)),lt(3,x0)],ft);export{mt as AuthzIoHttpService,m0 as AwaitingState,d0 as AwaitingWithPendingState,t0 as COLLABORATION_CLIENT_PLUGIN_CONFIG_KEY,tt as CollaborationController,Z0 as CollaborationEntity,Dt as CollaborationImageIoService,dt as CollaborationSession,F0 as CollaborationSessionService,Xt as CollaborationSocketService,Te as CollaborationStatus,l0 as CollaborationUIEventId,g0 as CollaborationUIEventService,Mt as CollaborativeUndoRedoService,Se as CommentService,p0 as ConflictState,Rx as DEFAULT_COLLAB_WEB_SOCKET_URL,rs as DEFAULT_REMOTE_UNISCRIPT_EXECUTION_ENDPOINT,es as DEFAULT_WS_SESSION_TICKET_URL,Nt as DataLoaderService,vt as DocCollaborationEntity,n0 as FetchingMissState,Ox as HEARTBEAT_INTERVAL_KEY,me as HEARTBEAT_TIMEOUT_KEY,Oe as ICollaborationSocketService,i0 as ILocalCacheService,Kx as INetworkConditionService,rt as ISingleActiveUnitService,is as LOCAL_CACHE_INTERVAL,xs as LOCAL_CACHE_INTERVAL_KEY,B0 as MemberService,Ut as MentionIoHttpService,E0 as OfflineState,f0 as PendingState,ss as REMOTE_UNISCRIPT_EXECUTION_ENDPOINT_KEY,Dx as RETRY_CONNECTING_MAX_COUNT_KEY,T0 as SessionStatus,_t as SheetCollaborationEntity,X0 as SheetTransformSelectionsService,At as SnapshotServerOverHTTPService,P0 as SyncedState,ge as UnitStatus,ft as UniverCollaborationClientPlugin,zx as deserializeToCombResponse,ns as getLocalCacheKey,Jx as serializeCombRequest};
